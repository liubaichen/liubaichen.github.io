<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>自然语言处理————推理方法</title>
      <link href="/posts/8acc63f2/"/>
      <url>/posts/8acc63f2/</url>
      
        <content type="html"><![CDATA[<h1>基于推理的方法————神经网络</h1>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 深度学习 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>daily English</title>
      <link href="/posts/49af6954/"/>
      <url>/posts/49af6954/</url>
      
        <content type="html"><![CDATA[<h1>2023.4.6</h1><blockquote><p>refute controvert rebut refuse counter deny disprove contradict reject</p></blockquote><h2 id="express-that-you-think-sth-is-wrong">express that you think sth is wrong</h2><p>refute/disprove sth: <strong>prove</strong> or say sth is wrong<br>rebut/controvert sth: say or prove sth is false</p><blockquote><p>such arguments are not easily refuted<br>I wanted to controvert the accusation but I couldn’t find any proofs</p></blockquote><p>counter/contradict sb/sth: <strong>prove</strong> sth is wrong<br>deny sth/doing sth: say sth is false</p><blockquote><p>there’s no denying that / it can’t be denied that<br>he denied attempting to murder his wife<br>you have just contradicted yourself</p></blockquote><p>summary: “deny” and “controvert/rebut” mean that say sth is wrong, and “refute” and “counter/contradict” mean that prove sth is wrong</p><h2 id="don’t-accept-sth-or-will-not-do-sth">don’t accept sth or will not do sth</h2><p>refuse sth/to do sth<br>reject sth<br>turn sb/sth down</p><blockquote><p>I flatly refused to accept that there was a problem<br>the prime minister rejected any ideas of reforming the system<br>he has been turned down for ten jobs so far</p></blockquote><h2 id="don’t-allow-sb-to-have-sth-or-give-sb-sth">don’t allow sb to have sth or give sb sth</h2><p>refuse / deny sb sth &amp; deny sth to sb</p><blockquote><p>they refused him a visa<br>they were denied access to the information</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> daily </category>
          
      </categories>
      
      
        <tags>
            
            <tag> English </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>自然语言处理————计数方法</title>
      <link href="/posts/6edc6e28/"/>
      <url>/posts/6edc6e28/</url>
      
        <content type="html"><![CDATA[<h1>绪论</h1><h2 id="计算高速化">计算高速化</h2><p>python和numpy中float的存储方式包括64、32和16，默认使用float64。但是float32占用更小的内存，且能够保证大致的准确度，因此在深度学习中经常使用。16位也可以保证较高的准确度，但由于GPU仅支持32位，所以不采用。google-colab上有提供TPU，可以支持至8位。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a = np.random.random([<span class="number">3</span>,<span class="number">4</span>]).astype(np.float32)</span><br><span class="line">a.dtype     <span class="comment">#dtype(&#x27;float32&#x27;)</span></span><br></pre></td></tr></table></figure><h2 id="自然语言">自然语言</h2><p>人类语言称为自然语音，而自然语言处理的目的是让计算机理解人类语言。同义词词典是一种人工定义的单词网络。随着深度学习的出现，这种耗费巨大人力的方法已经不再是最佳选择。</p><h1>基于计数的方法</h1><h2 id="预处理">预处理</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="comment"># method1</span></span><br><span class="line">text = <span class="string">&quot;I like python.&quot;</span></span><br><span class="line">text.lower()</span><br><span class="line">text=text.replace(<span class="string">&#x27;.&#x27;</span>,<span class="string">&#x27; .&#x27;</span>)</span><br><span class="line">text.split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># method2(recommended)</span></span><br><span class="line">text = <span class="string">&quot;I like python.&quot;</span></span><br><span class="line">text.lower()</span><br><span class="line">regex = re.<span class="built_in">compile</span>(<span class="string">r&quot;\W+&quot;</span>)</span><br><span class="line">b = re.split(regex,text)</span><br><span class="line"></span><br><span class="line"><span class="comment"># preprocess function</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">preprocess</span>(<span class="params">text</span>):</span><br><span class="line">    text = text.lower()</span><br><span class="line">    regex = re.<span class="built_in">compile</span>(<span class="string">r&quot;\W+&quot;</span>)</span><br><span class="line">    words = re.split(regex,text)</span><br><span class="line">    </span><br><span class="line">    word2id = &#123;&#125;</span><br><span class="line">    id2word = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> word <span class="keyword">in</span> words:</span><br><span class="line">        <span class="keyword">if</span> word <span class="keyword">not</span> <span class="keyword">in</span> word2id:</span><br><span class="line">            new_id = <span class="built_in">len</span>(word2id)</span><br><span class="line">            word2id[word] = new_id</span><br><span class="line">            id2word[new_id] = word</span><br><span class="line">    corpus = np.array([word2id[w] <span class="keyword">for</span> w <span class="keyword">in</span> words])</span><br><span class="line">    <span class="keyword">return</span> corpus,word2id,id2word</span><br></pre></td></tr></table></figure><h2 id="分布式表示">分布式表示</h2><p>分布式假设(distributional hypothesis)：单词含义由上下文（周围的单词）决定<br>分布式表示：向量表示单词,就像用三维RGB矩阵表示颜色一样<br>窗口大小(window size)：要考虑的上下文的单词数</p><p>对’you say goodbye and i say hello’这句话使用分布式表示，window size为1：</p><p><img src="https://picgo-liubaichen.oss-cn-beijing.aliyuncs.com/co-occurence_matrix.png" alt="co-occurence_matrix"></p><p>由频数向量组成的矩阵称为共现矩阵(co-occurence matrix)，下面的代码实现了从corpus获得共现矩阵</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">create_co_matrix</span>(<span class="params">corpus,vocabulary_size,window_size=<span class="number">1</span></span>):</span><br><span class="line">    corpus_size = <span class="built_in">len</span>(corpus)</span><br><span class="line">    co_matrix = np.zeros([vocabulary_size,vocabulary_size],dtype=np.int32)</span><br><span class="line">    <span class="keyword">for</span> index,word_id <span class="keyword">in</span> <span class="built_in">enumerate</span>(corpus):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,window_size+<span class="number">1</span>):</span><br><span class="line">            left_index = index - i</span><br><span class="line">            right_index = index + i</span><br><span class="line">            <span class="keyword">if</span> left_index&gt;=<span class="number">0</span>:</span><br><span class="line">                left_word_id = corpus[left_index]</span><br><span class="line">                co_matrix[word_id][left_word_id] += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> right_index&lt;corpus_size:</span><br><span class="line">                right_word_id = corpus[right_index]</span><br><span class="line">                co_matrix[word_id][right_word_id] += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> co_matrix</span><br></pre></td></tr></table></figure><h2 id="向量相似性">向量相似性</h2><p>共现矩阵的向量表示每一个单词的特征，通过余弦相似度可以得到向量间的相似性。其计算方法为对x和y归一化后点积。为避免0作为分母，引入极小量eps</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>s</mi><mi>i</mi><mi>m</mi><mi>i</mi><mi>l</mi><mi>a</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>y</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mrow><msub><mi>x</mi><mn>1</mn></msub><msub><mi>y</mi><mn>1</mn></msub><mo>+</mo><mo separator="true">⋅</mo><mo separator="true">⋅</mo><mo separator="true">⋅</mo><mo>+</mo><msub><mi>x</mi><mi>n</mi></msub><msub><mi>y</mi><mi>n</mi></msub></mrow><mrow><msqrt><mrow><msubsup><mi>x</mi><mn>1</mn><mn>2</mn></msubsup><mo>+</mo><mo separator="true">⋅</mo><mo separator="true">⋅</mo><mo separator="true">⋅</mo><mo>+</mo><msubsup><mi>x</mi><mi>n</mi><mn>2</mn></msubsup></mrow></msqrt><mo>+</mo><msqrt><mrow><msubsup><mi>y</mi><mn>1</mn><mn>2</mn></msubsup><mo>+</mo><mo separator="true">⋅</mo><mo separator="true">⋅</mo><mo separator="true">⋅</mo><mo>+</mo><msubsup><mi>y</mi><mi>n</mi><mn>2</mn></msubsup></mrow></msqrt></mrow></mfrac></mrow><annotation encoding="application/x-tex">similarity(x,y)=\frac{x_1y_1+···+x_ny_n}{\sqrt{x_1^2+···+x_n^2}+\sqrt{y_1^2+···+y_n^2}}  </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">imi</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.3903em;vertical-align:-1.13em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.2603em;"><span style="top:-2.1602em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9498em;"><span class="svg-align" style="top:-3.2em;"><span class="pstrut" style="height:3.2em;"></span><span class="mord" style="padding-left:1em;"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7959em;"><span style="top:-2.4337em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.0448em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2663em;"><span></span></span></span></span></span></span><span class="mord">+</span><span class="mpunct">⋅⋅⋅</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">+</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.9098em;"><span class="pstrut" style="height:3.2em;"></span><span class="hide-tail" style="min-width:1.02em;height:1.28em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='1.28em' viewBox='0 0 400000 1296' preserveAspectRatio='xMinYMin slice'><path d='M263,681c0.7,0,18,39.7,52,119c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120c340,-704.7,510.7,-1060.3,512,-1067l0 -0c4.7,-7.3,11,-11,19,-11H40000v40H1012.3s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60zM1001 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2902em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9498em;"><span class="svg-align" style="top:-3.2em;"><span class="pstrut" style="height:3.2em;"></span><span class="mord" style="padding-left:1em;"><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7959em;"><span style="top:-2.4337em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.0448em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2663em;"><span></span></span></span></span></span></span><span class="mord">+</span><span class="mpunct">⋅⋅⋅</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">+</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.453em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.9098em;"><span class="pstrut" style="height:3.2em;"></span><span class="hide-tail" style="min-width:1.02em;height:1.28em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='1.28em' viewBox='0 0 400000 1296' preserveAspectRatio='xMinYMin slice'><path d='M263,681c0.7,0,18,39.7,52,119c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120c340,-704.7,510.7,-1060.3,512,-1067l0 -0c4.7,-7.3,11,-11,19,-11H40000v40H1012.3s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60zM1001 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2902em;"><span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">+</span><span class="mpunct">⋅⋅⋅</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">+</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.13em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">cos_similarity</span>(<span class="params">x,y,eps=<span class="number">1e-8</span></span>):</span><br><span class="line">    nx = x / (np.sqrt(np.<span class="built_in">sum</span>(x ** <span class="number">2</span>)) + eps)</span><br><span class="line">    ny = y / (np.sqrt(np.<span class="built_in">sum</span>(y ** <span class="number">2</span>)) + eps)</span><br><span class="line">    <span class="keyword">return</span> np.dot(nx, ny)</span><br></pre></td></tr></table></figure><p>可以通过比较两向量间的余弦相似度比较单词的相似性</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">most_similar</span>(<span class="params">query, word_to_id, id_to_word, word_matrix, top=<span class="number">5</span></span>):</span><br><span class="line">    <span class="keyword">if</span> query <span class="keyword">not</span> <span class="keyword">in</span> word_to_id:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;%s is not found&#x27;</span> % query)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\n[query] &#x27;</span> + query)</span><br><span class="line">    query_id = word_to_id[query]</span><br><span class="line">    query_vec = word_matrix[query_id]</span><br><span class="line"></span><br><span class="line">    vocab_size = <span class="built_in">len</span>(id_to_word)</span><br><span class="line"></span><br><span class="line">    similarity = np.zeros(vocab_size)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(vocab_size):</span><br><span class="line">        similarity[i] = cos_similarity(word_matrix[i], query_vec)</span><br><span class="line"></span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> (-<span class="number">1</span> * similarity).argsort():</span><br><span class="line">        <span class="keyword">if</span> id_to_word[i] == query:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27; %s: %s&#x27;</span> % (id_to_word[i], similarity[i]))</span><br><span class="line"></span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> count &gt;= top:</span><br><span class="line">            <span class="keyword">return</span></span><br></pre></td></tr></table></figure><p>argsort函数可以按照升序返回index，因此前面加上负号后就是降序</p><h2 id="点互信息">点互信息</h2><p>点互信息(pointwise mutual information)，是另一种用于描述单词间关联性的指标。设想在一段文字中，诸如定冠词the或不定冠词a/an之类的词汇很多，这些词语与后面跟的名词的向量相似性非常强，但是the/a/an并不是我们真正关心的对象，实际上与car关联的drive等才是目标对象！为了抛开这种影响需要引入点互信息：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>P</mi><mi>M</mi><mi>I</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo><mo>=</mo><mi>l</mi><mi>o</mi><msub><mi>g</mi><mn>2</mn></msub><mfrac><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mi>P</mi><mo stretchy="false">(</mo><mi>y</mi><mo stretchy="false">)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">PMI(x,y)=log_2 \frac {P(x,y)}{P(x)P(y)} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">PM</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.363em;vertical-align:-0.936em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>上式的右半部分曾经在概率中接触过，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P(x,y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span> 表示x和y事件同时发生的概率，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P(y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span> 可以类比得到。使用共现矩阵可以表示为</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>P</mi><mi>M</mi><mi>I</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo><mo>=</mo><mi>l</mi><mi>o</mi><msub><mi>g</mi><mn>2</mn></msub><mfrac><mrow><mi>C</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo><mo>×</mo><mi>N</mi></mrow><mrow><mi>C</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mi>C</mi><mo stretchy="false">(</mo><mi>y</mi><mo stretchy="false">)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">PMI(x,y)=log_2 \frac{C(x,y)\times N}{C(x)C(y)} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">PM</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.363em;vertical-align:-0.936em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>其中C为共现矩阵，C(x,y)表示x和y的共现矩阵元素，N表示语料库的单词数量（共现矩阵sum）。为了避免共现次数为0导致的-inf问题，可以引入正点互信息PPMI</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>P</mi><mi>P</mi><mi>M</mi><mi>I</mi><mo>=</mo><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><mi>P</mi><mi>M</mi><mi>I</mi><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">PPMI=max(PMI,0) </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">PPM</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">ma</span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">PM</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mclose">)</span></span></span></span></span></p><h2 id="奇异值分解">奇异值分解</h2><p>酉矩阵（实数）的定义是一个方阵和其转置的点积为单位矩阵</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>U</mi><mi>T</mi></msup><mi>U</mi><mo>=</mo><mi>I</mi></mrow><annotation encoding="application/x-tex">U^TU=I </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8913em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>U</mi><msup><mi>U</mi><mi>T</mi></msup><mo>=</mo><mi>I</mi></mrow><annotation encoding="application/x-tex">UU^T=I </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8913em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span></span></span></span></span></p><p>奇异值分解(SVD)是一种矩阵的降维方法，其可以将任意的(m,n)矩阵分解为三个矩阵的乘积</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>X</mi><mo>=</mo><mi>U</mi><mi>S</mi><msup><mi>V</mi><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">X=USV^T </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8913em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span></span></p><p>其中X为待分解矩阵(m,n)，U为(m,m)方阵，S为(m,n)的单位矩阵，T为(n,n)方阵。S的对角线元素称为奇异值(singular value)数学求解方法还没有看，毕竟python能直接计算···大致流程是通过计算 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><msup><mi>X</mi><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">XX^T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8413em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>X</mi><mi>T</mi></msup><mi>X</mi></mrow><annotation encoding="application/x-tex">X^TX</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8413em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span> 的特征值可以得到奇异值。SVD处理过程如下图所示：U矩阵被视为“单词空间”，构成了空间基轴；S矩阵中奇异值按降序排列，且下降得特别快，前几个值就可以近似描述原始矩阵；因此可以去除U矩阵中的部分列实现降维。如我们认为S矩阵中的前k个值可以表示X矩阵，则U矩阵可以只保留前k列（即图中的 $ U^{'} $）。若k为2，则可以将多维共现矩阵转化为2为矩阵</p><p><img src="https://picgo-liubaichen.oss-cn-beijing.aliyuncs.com/SVD-PPMI.png" alt="SVD-PPMI"></p><h2 id="summary">summary</h2><p>本节的内容主要是将一段文字转化为单词的特征向量组成的矩阵。首先通过preprocess获得单词与id的索引以及语料库corpus；通过分布式表示处理corpus获得共现矩阵，这里就获得了最原始的特征向量矩阵；通过点互信息和奇异值分解对共现矩阵做进一步处理，最后通过余弦相似度比较单词的相似性</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">corpus,word2id,id2word = preprocess(<span class="string">&#x27;You say goodbye and I say hello.&#x27;</span>)</span><br><span class="line">co_matrix = create_co_matrix(corpus,<span class="built_in">len</span>(corpus),window_size=<span class="number">1</span>)</span><br><span class="line">PPMI = ppmi(co_matrix)</span><br><span class="line"><span class="comment">#np.set_printoptions(precision=3)</span></span><br><span class="line">U,S,V  = np.linalg.svd(PPMI)</span><br><span class="line">word_vec = U[:,:<span class="number">2</span>]</span><br><span class="line">querys = [<span class="string">&#x27;you&#x27;</span>,<span class="string">&#x27;goodbye&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> query <span class="keyword">in</span> querys:</span><br><span class="line">    most_similar(query,word2id,id2word,word_vec,top=<span class="number">3</span>)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 深度学习 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>放弃“世界革命”与共产国际的解散</title>
      <link href="/posts/23474/"/>
      <url>/posts/23474/</url>
      
        <content type="html"><![CDATA[<p>本篇来自《一个大国的崛起与崩溃——苏联历史专题研究（1917-1991）》，作者为沈志华。</p><h1>共产国际（第三国际）</h1><p>根据马克思主义理论，社会主义革命是世界性的，至少会在西欧等文明国家同时发生，共产国际正是在这样一种理论下于1919年建立的。1920年，国内战争的胜利使无数共产主义者看到了社会主义革命的希望，共产国际通过了发动世界革命的决议。1923年革命风暴的平息和西欧资本主义的稳步发展，使得苏共·共产国际对世界革命的看法有了分歧。托洛茨基和季诺维耶夫·加米涅夫代表的两大反对派坚持世界革命，对斯大林的“一国社会主义论”进行了猛烈批判。然而他们既没有斯大林那么强硬的政治手腕，在理论上也过于脱离实际，最终败给了斯大林。随后共产国际在斯大林领导下逐渐由一个世界革命组织转变为控制各国共产党的工具。</p><p>1929年资本主义经济危机，共产国际抓住机会宣传“法西斯主义是一种革命和民主的组织”（指相对于资产阶级政府和社会民主主义），希望借此发动世界革命推翻资产阶级政府。1933年德国法西斯成为苏联的头号威胁时，共产国际又开始批判法西斯主义剥夺了民主，要求各国共产党与政府合作，建立反法西斯主义阵线。1938年苏联与英法的谈判迟迟无果，转而与德国签订秘密协定后，共产国际又开始命令各国共产党反政府、反战争、淡化反法西斯宣传。这种180度的大转弯搞得各国共产党内部的意见无法统一，共产国际的权威性大受影响，俨然成了一个笑柄。</p><h1>二战中的共产国际</h1><p>1941年苏共内部就出现质疑共产国际存在意义的质疑声。并且日丹诺夫和共产国际高层还商讨了解散共产国际的充分理由：<strong>不给资本主义阵营留以把柄，即共产党是服从于国外组织的叛徒</strong>；使各国共产党真正成为本国人民的党。但是在斯大林看来，解散共产国际最重要的原因是国际形势扑朔迷离，世界革命看不到希望，无论选择英法还是德国，都必须与借助资本主义的力量保证自身的安全。此外，共产国际在各国的权威性大幅度受损，无助于团结各国共产党。</p><p>6月苏德战争爆发后，共产国际的倾向完全转变由世界革命转向民族国家利益，并且愈发成为斯大林与英美合作的绊脚石。另一方面，共产国际也制约了各国共产党的发展。例如中国共产党和南斯拉夫共产党希望将反法西斯战争同社会主义革命相结合，遭到共产国际的断然否认。因此在1941-1942年法西斯占据优势的时期，共产国际陷入低谷，处于半死不活的状态。另一个相关事件是，1942年苏联和英国划分战后势力范围，苏联为了促使英国在欧洲大陆登陆不惜牺牲自己的领土要求。但彼时英国深陷北非战役，无力帮助苏联。</p><p>1943年起，二战形势开始变化。斯大林格勒战役结束后，苏军开始反攻，共产国际又忙活了起来。5月北非战役结束，英美计划开辟第二战争，但是4月曝光的卡廷事件又给盟军关系造成阴影。在这种形势下，斯大林必须做出让步以回应英国的不满。5月14日，丘吉尔到达华盛顿会见罗斯福，斯大林急于让西方盟友知道共产国际将要解散，但又担心会引起各国共产党的涣散。在此之前的5月8日，莫洛托夫受斯大林执意向共产国际的两个领导人季米特洛夫和马努伊尔斯基传达了解散共产国际的计划。12日，共产国际内部召开会议通报解散事宜，大多数人表示支持。19日，苏共高层会议，斯大林将解散的缘由推给某些支部（推卸责任），并确定在10天后正式公开。结果第二天斯大林就打电话给季米特洛夫，希望他当天就告知给各党的领导人，斯大林已经等不及了。22日，《真理报》率先公布了这一消息，斯大林迫不及待地向记者解释解散共产国际的原因（本节第一段加粗文字）。季米特洛夫打算在得到绝大多数支部的认可后宣布正式解散，但斯大林又双叒叕不耐烦了，追问必须要等到所有党表明态度吗？最终季米特洛夫只得同意在6月8日前召开会议。最终，《真理报》在6月10日刊登了31个支持解散的支部名单和共产国际的决议，共产国际正式解散。</p><h1>放弃世界革命</h1><p>共产国际解散后，原有附属组织和工作人员并没有被撤销/解雇，而是整体迁移到了新的组织——联共(布)中央国际情报部和中央国际部，季米特洛夫继续担任国际情报部的副部长和国际部的部长。但是据此得出斯大林是演戏给西方看的说法是不符合事实的。首先，从种种言行中可以看出斯大林已经放弃了世界革命的相法，如1944年取消将《国际歌》作为国歌、抹去共产国际的痕迹（甚至连路名都不放过）、1944年与丘吉尔会谈时明确表明不再发动欧洲革命。斯大林希望苏联能够融入国际社会，与资本主义大国共同建立和平体制。既然放弃世界革命，共产国际作为一个组织就完全失去了存在意义。</p>]]></content>
      
      
      <categories>
          
          <category> 历史 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 苏联史 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>音乐收藏</title>
      <link href="/posts/52394/"/>
      <url>/posts/52394/</url>
      
        <content type="html"><![CDATA[<p>自己倾向于在一段时间反复的听一首或几首歌（比如今天就突然想听大概一两年前特别喜欢的歌），呈现出明显的周期性，所以就想着记录一下（实际上也是音乐取向）</p><h1>魔法少女小圆</h1><p>今天就是魔圆回顾专场，最近一个月每天都在听！整理了一下魔圆六个作品集中特别喜欢的歌曲，并且放到了自己的网站充当背景音乐。每一首都是百听不厌的经典！最喜欢的有we’re here for you, her new wings, her wings, happy ending, i miss you, rebirth, prelude to act 2, Nux Walpurgis, Terror adhaerens, Credens justitiam, Numquam vincar,fateful #4</p><h1>乃木坂46</h1><p>时间：2017-2021，主推堀未央奈、北野日奈子（两人毕业后就退坑了），最仰慕的成员是橋本奈々未（入坑契机），即使已经隐退，乃团仍然充满着她的个人魅力。最喜欢サヨナラの意味（毫无疑问的最神曲且没有之一！），之后是冷たい水の中（最喜欢的solo曲）、きっかけ、命は美しい、いつかできるから今日できる、シンクロニシティ、別れ際はもっと好きになる、もう少しの夢。每次听到乃团的歌都会想起回不去的高中生活，回想起有乃团音乐陪伴下的每一天，好怀念啊！乃木坂46真真切切地改变了我的人生轨迹印象：首次接触日本的三次元文化；开始学日语；2018年6月膝盖因为运动受伤而做手术后，是命は美しい伴我度过一个个难熬的夜晚；竞赛结束回归高考的艰难时期，是いつかできるから今日できる和シンクロニシティ一次次让我从低谷中站起来；2018年底上海演唱会，沉醉于帰り道は遠回りしたくなる之中，甚至还为此和自己非常喜欢的老师吵了一架；2019年上半年，是キャラバンは眠らない和僕だけの光让我坦然面对。</p><h1>魔法使いの夜</h1><p>魔夜的纯音乐真的是艺术品（在我心目中比肩魔圆的存在），在2021、2022年经常听，最喜欢的有蒼崎青子、five、久遠寺有珠、10th symphony type/MOON</p><h1>ClariS</h1><p>除乃木坂46外最喜欢的女性团体，因为魔圆而了解。最喜欢的有コネクト（the first take ver. 完美还原魔圆永恒的物语结尾的交响乐！）、ひらひらひらら（一番大好き！）、忘れてもないよ、ルミナス、明日春が来たら、オルゴール</p><h1>雨宫天</h1><p>非常喜欢的一位女性声优，因为魔圆而了解，在2022年暑假期间每天都听。最喜欢的有paradox（the first take ver. 最佳好评！）、羽根輪舞（优雅）、フリイジア（一番大好き！）</p><h1>魔圆外传</h1><p>与魔圆本篇一脉相承，音乐也是相当地出色，2022年暑期和下半学期经常听。最喜欢的有inception、intermediate（一番大好き！）、anxiety、wings of magius、叶えちゃお、山茶花の跡、revive</p><h1>无归属纯音乐篇</h1><p>由于没有太多共同特征，因此只是准备列举一下：</p><ul><li>古典风格     miyako(from the album ancient city 2)、verdurous mountains（充满东方韵味的古典风格音乐）、brookside、love(S.E.N.E)、風のように、夜明、</li><li>火影忍者     五月雨</li><li>刀剑神域     swordland、a tender feeling、luminous sword</li><li>你的名字     theme of mitsuha（一首把我带入二次元世界的音乐）</li><li>缘之空       遠い空へ</li><li>怪物猎人     无名猎人的矜持</li></ul><h1>少女歌剧</h1><p>由于我只看过TV和剧场版，所以对手游中的歌曲不太了解。2021和2020年经常听，最喜欢的有rondorondorondo（一番大好き！）、華恋とひかり、舞台少女心得 幕间（超级好听！）、星のダイアローグ、命尽きても尽き果てず、世界を灰にするまで、スタアライト、star parade、re：create（一番大好き！）、情熱の目覚めるとき</p><h1>當山みれい</h1><p>非常喜欢的女性歌手，2022年下半年经常听。最喜欢的有missing you、願いあの頃のキミへ、またねがあれば，其中前两首是我认为能够称之为传世经典的歌曲。</p><h1>MACO</h1><p>最喜欢的歌手（没有之一！），从2017年开始每年都会有一段时间疯狂单曲循环，人美声更美，无论是人声还是乐曲风格都是绝对的一流。最喜欢的有恋の道（一番大好き）、dear my friend、happy tears、運命、桜の木の下、however、story、hero(studio live version)、三月九日、夏風邪、再恋愛</p><h1>kalafina</h1><p>因为魔圆而了解，非常有特色的女性乐队，非常可惜的是已经解散了（魔圆新剧场版的ed和插曲怎么办啊！！！）。最喜欢的有百火燎乱、君が光に変えていく、seventh heaven(一番大好き)、光の旋律、満天、ひかりふる、to the beginning()、magia[quattro]、君の銀の庭、believe</p><h1>miwa</h1><p>超级喜欢的女性歌手，嗓音很有特色。喜欢的有ヒカリへ、delight、don’t cry anymore、片想い、春になったら、ホイッスル君と過ごした日々</p><h1>平井坚</h1><p>平井坚（索尼一姐？）的音色是真的逆天！最喜欢的有告白和gaining through losing</p><h1>back number</h1><p>因为堀未央奈而了解，日式乐团风格。最喜欢的有happy end、christmas song、花束、雨を濡らす雨のように</p><h1>LoveLive!虹咲学园学园偶像同好会</h1><p>2020年接触，也是lovelive系列中唯一在推的团，</p>]]></content>
      
      
      <categories>
          
          <category> diary </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 杂谈 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>切片复习</title>
      <link href="/posts/51988/"/>
      <url>/posts/51988/</url>
      
        <content type="html"><![CDATA[<p>学习numpy和神经网络的时候深感对切片的理解不到位，所以抽时间深入了解切片</p><p>切片的构成语法如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a[start:stop:step]</span><br><span class="line"><span class="comment">#! :step是可选参数</span></span><br></pre></td></tr></table></figure><p>如果只是上面这样就还好理解，问题出在三个参数经常出现缺省，如</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">5</span>))</span><br><span class="line">a[::<span class="number">2</span>]      <span class="comment">#[0, 2, 4]</span></span><br><span class="line">a[:<span class="number">2</span>]       <span class="comment">#[0, 1]</span></span><br></pre></td></tr></table></figure><p>在参数缺省的情况下，python默认取最大区间，如a[::2]即为全区间，a[:2]的index为0、1。另外需要注意的是，如果start和stop超出范围（如start过小或start大于stop等），python并不会报错，而是返回有效值或空值</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a[<span class="number">2</span>:<span class="number">1</span>]  <span class="comment">#[]</span></span><br><span class="line">a[-<span class="number">10</span>:<span class="number">4</span>]    <span class="comment">#[0, 1, 2, 3]</span></span><br></pre></td></tr></table></figure><p>二维数组的切片需要使用两个切片，并用逗号隔开</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a = np.arange(<span class="number">6</span>).reshape(<span class="number">2</span>,-<span class="number">1</span>)</span><br><span class="line">a[:,::<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">array([[<span class="number">0</span>, <span class="number">2</span>],</span><br><span class="line">       [<span class="number">3</span>, <span class="number">5</span>]])</span><br></pre></td></tr></table></figure><p>二维数组中行优先于列，因此只有一个切片默认是对行</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a = np.arange(<span class="number">6</span>).reshape(<span class="number">2</span>,-<span class="number">1</span>)</span><br><span class="line">a[<span class="number">1</span>:]</span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">array([[<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]])</span><br></pre></td></tr></table></figure><p>numpy中对列的操作会默认转化为行向量</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a = np.arange(<span class="number">6</span>).reshape(<span class="number">2</span>,-<span class="number">1</span>)</span><br><span class="line">a[:,<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">array([<span class="number">1</span>, <span class="number">4</span>])</span><br></pre></td></tr></table></figure><p>观察发现，上述两个结果的形式不同，第一个结果有两对中括号，第二个结果只有一对。原因是1:的对象是从第二行开始的所有行，numpy认为这是一个二维数组（尽管实际上是一维的）。而:,1表示第二列元素，无论怎么取都只能是一维数组</p><p>numpy中对列的操作会默认转化为行向量，但是也可以通过其他手段获得列向量</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">a = np.arange(<span class="number">5</span>)</span><br><span class="line">a.reshape(-<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">array([[<span class="number">0</span>],</span><br><span class="line">       [<span class="number">1</span>],</span><br><span class="line">       [<span class="number">2</span>],</span><br><span class="line">       [<span class="number">3</span>],</span><br><span class="line">       [<span class="number">4</span>]])</span><br></pre></td></tr></table></figure><p>将reshape的第一参数设置为-1（表示自动计算），第二参数设为1（表示列数为1），即可获得列向量</p><p>切片操作也有类似的用法</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">a = np.arange(<span class="number">25</span>).reshape(<span class="number">5</span>,-<span class="number">1</span>)</span><br><span class="line">a[<span class="number">1</span>:,:<span class="number">1</span>]</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">array([[ <span class="number">5</span>],</span><br><span class="line">       [<span class="number">10</span>],</span><br><span class="line">       [<span class="number">15</span>],</span><br><span class="line">       [<span class="number">20</span>]])</span><br><span class="line"></span><br><span class="line">a = np.arange(<span class="number">25</span>).reshape(<span class="number">5</span>,-<span class="number">1</span>)</span><br><span class="line">a[<span class="number">1</span>:,<span class="number">0</span>]</span><br><span class="line"><span class="comment">#array([ 5, 10, 15, 20])</span></span><br></pre></td></tr></table></figure><p>上述两段代码都是取第一列部分元素，区别在[1:,:1]会被处理为二维数组，因此可以表示列向量；a[1:,0]被处理为一维数组，只能表示行向量</p>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 杂谈 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>国家工业化 &amp; 布哈林与斯大林之争</title>
      <link href="/posts/14792/"/>
      <url>/posts/14792/</url>
      
        <content type="html"><![CDATA[<p>本篇来自《苏联兴亡史》，记录时间为2022年11月17日</p><p>1930年十六大报告正式将苏联国家工业化称之为“社会主义工业化”。其与资本主义工业化的区别是：</p><ol><li>从何开始——重工业</li><li>速度——高速度</li><li>资金来源——依靠本国积累资金</li></ol><h1>重工业优先的确立</h1><p>斯大林和托洛茨基的争斗也体现在工业发展路径上。托洛茨基主张“世界分工论 ”，即苏联（社会主义国家）与资本主义国家之间相互依赖，以加强对世界资产阶级的斗争。斯大林为了对抗托洛茨基，始终坚持重工业优先原则，并将其上升到了一种“社会主义规律”的浮夸高度上。这就好像是在说，由于资本主义国家都是从轻工业开始，那社会主义国家必须从重工业开始，即是否优先发展重工业成了区分社会主义和资本主义的标志。</p><blockquote><p>事实上，沙俄和德国也都是从重工业开始发展的</p></blockquote><h1>“高速度”</h1><p>1926年6月中央全会，李可夫主张保守经济发展路线，并得到了中央派的支持。而托洛茨基则认为经济恢复后的苏联经济将快速发展，被称为“超工业化”理论。不久后就提出了用最短时间赶超资本主义国家的口号，第聂伯河水电站等大批项目仓促上马，“高速度”已见雏形。不过直到1927年底的十五大还都算是维持较为稳妥的经济路线。随着托李联盟被击溃，特别是1928年布哈林因“右倾机会主义”被批判后，斯大林继承了托洛茨基的“超工业化”理论，提出了一系列“十年赶超五十年甚至一百年的差距”、“用真正的布尔什维克的速度，在最短时间消灭这种落后状况，赶上并超过所有先进的资本主义国家”、“落后就要挨打”等一系列耳熟能详的论调，“高速度”成为社会主义国家最为典型的特征。</p><p>为什么斯大林经济政策倾向的转变如此迅速？难道他真的是“开窍”了？我想不是这样。斯大林并不是托洛茨基那样张扬跋扈的人，后者的思维是始终如一的，即一切事物的发展都以世界革命为中心。斯大林为了对抗托洛茨基，必须提出相反的论调，即使他认同托洛茨基的观点。因此当托洛茨基一被打倒，斯大林就立即着手“高速度”发展策略。</p><h1>“国内殖民地”——工业化资金来源</h1><p>社会主义国家的工业化不同于资本主义国家的工业化，工业建设是由国家有计划有组织地进行的，它与资本主义国家分散地自发地进行工业建设完全不同。苏联工业化的建设资金要由国家统一筹集，资金从哪里来？</p><p>经济学家普列奥布拉任斯基，在1924年《共产主义科学院学报》第8期上发表《社会主义积累的基本规律》一文，提出“社会主义原始积累”理论。普列奥布拉任斯基认为，在俄国这样一个生产力水平低下，小生产者占优势的国家里，<strong>社会主义工业化的资金不能依靠掠夺殖民地，只能把小生产当作“殖民地”</strong>。他说：“向社会主义生产组织过渡的某一国家在经济上愈落后，小资产阶级性即农民性愈严重，该国无产阶级在社会革命时能得到充作自己社会主义积累资金的遗产愈小，这个国家的社会主义积累就愈要被迫依赖于社会主义以前的经济形式的部分剩余产品的转让，靠在他自已的生产基础上来积累的比重就愈小，就是说，这个国家的发展愈不依赖社会主义工业工作者的剩余产品”。由此，他提出，“认为社会主义经济可以不触动小资产阶级包括农民经济资源而自行发展的思想，无疑是反动的小资产阶级的空想。<strong>社会主义国家在这里的任务不是从小资产阶级生产者那里拿得比资本主义从他们那里拿得更少的东西，而是拿得更多</strong>。”除了向小生产者征收高额税金进行积累以外，普列奥布拉任斯基还反对通过正常的市场关系来为工业化积累资金，主张用超经济强制的行政手段来积累资金。如国家利用垄断地位提高工业品价格以及铁路运价，等等。他说：“通过相应的价格政策进行积累，比起向小生产征收直接税和间接税的其他形式更优越，最主要的优越性是征收非常方便，不需要在专门的税收机关上花一个戈比”。他还认为可以通过国家银行的垄断地位，向农民发放高利贷，发行纸币，他说：“当国家既是管理全国的机构，又是极其庞大的经济综合体的主人的时候，发行纸币是社会主义积累的直接渠道”</p><p>普列奥布拉任斯基的反对者是曾经的左派、现在的“右派”布哈林。他指出，普列奥布拉任斯基理论上的一个基本错误，在于把农民小生产者看作剥削对象，看作“殖民地”，这就把工农两个基本阶级的关系看作剥削关系，无产阶级成了剥削阶级，而且，据说，完成社会主义变革的国家愈落后，无产阶级的剥削性质就愈明显。布哈林驳斥了这种观点，他认为，在社会主义工业化过程中，确实存在小生产者的剩余价值充当积累资金，存在着一个阶级创造的价值转移到另一个阶级即统治阶级手中的情形，但决不能据此得出结论，称无产阶级为剥削阶级，称工业化时期的工农关系为剥削关系。布哈林说，这决不是因为“剥削”这个名同“很难听”，而是因为这种说法不符合常观实际。从历史上看，剥削关系的存在，通过积累，都会“经常再生产出剥削关系。价值从一个阶级手中转到另一个阶级手中，这就会经常扩大阶级对立”。在社会主义工业化时期，价值从小生产者手中转到无产阶级工业手中表现了什么呢？布哈林回答说：“<strong>我们根本不是要去巩固阶级之间的关系，而且要去消灭这些关系。社会主义经济成分及其正在形成的社会主义外围的积累进行得愈快，对立的消灭也就进行得愈快</strong>”。布哈林认为，社会主义工业需要小生产者提供积累，但不能对小生产者实行剥夺，不能通过使农民经济破产的办法来排挤农民经济，如果听任原始积累的骑士去同小生产打交道，就会损害工农联盟。如果对农民实行剥夺和“吞没”的方针，就会使农业衰败，使农民收入降低，而农民的市场容量，是直接决定轻工业、部分地是决定其他工业规模的重要因素之一。因此，社会主义工业中的积累必须同农民经济中的积累问题相联系。如果农民需求缩减，就会出现销售危机，社会再生产过程就会减慢，而在小农占优势的国家，社会主义工业的积累在很大程度上是农民经济的“函数”，而采用普列奥布拉任斯基的主张，无异于“杀掉会生金蛋的母鸡&quot;</p><blockquote><p>无论怎么评说，社会主义原始积累理论已经通过实践检验了其必然性（而非正确性）</p></blockquote><h1>布哈林同斯大林的争论及结果</h1><p>布哈林的“国民经济平衡发展”理论核心内容：1、多种经济之间的平衡发展；2、保证农、轻、重恰当的比例关系；3、积累与消费的平衡发展；4、计划与市场的平衡发展。1927年底到1928年春的粮食收购危机成为布哈林和斯大林争论的开端。布哈林认为国家计划领导失败的表现包括：</p><ol><li>农产品价格不合理，谷物收购价过低，技术作物和畜产品偏高；导致农民缩小谷物种植规模，甚至把余粮饲养牲畜</li><li>基础建设投资增加太快、太多，导致供应农村市场的商品减少，破坏城乡平衡</li><li>苏维埃的货币还没有稳定到使农民可以安心地把它作为积累手段的地步。因此农民更倾向于将粮食作为积累手段</li></ol><p>斯大林的看法与布哈林大相径庭：</p><ol><li>工业发展速度太慢，社会主义积累太少，致使农村商品供应不足</li><li>苏联已经成为小农国家，而小农经济是提供商品粮极少的一种经济成分</li><li>富农迅速成长，投机倒把，操纵粮价，破坏粮食征收工作</li></ol><p>故斯大林认为根本出路是迅速实现农业集体化。他认为这样做可以生产最大量的粮食，并且过渡到公共经济。</p><p>布哈林和斯大林的分歧是根本且全方位的：布哈林清醒地认识到苏联的危机表现为“商品荒”，是资本主义经济危机表现形式的颠倒。他认为群众消费的增长是社会经济增长的直接动力，过渡时期的基本路线是矛盾缩小和最后消亡的路线，并坚决反对斯大林的“阶级斗争”理论：社会主义的前进动力是阶级斗争，社会主义建设中的一切成就都是阶级斗争的表现和结果；社会主义越是取得胜利，阶级斗争就越来越尖锐。 在斯大林的强硬政策下，农村出现各种骇人听闻的悲剧都是必然的。在这种形势下，农民普遍流露出：“<strong>多种粮食有什么好处，反正都要没收；要是只种够自己吃的呢，还少交税</strong>” 。</p><blockquote><p>1929年爆发的全球性金融危机的关键原因之一便是民众消费意愿减弱，市场对商品的总需求量减少</p></blockquote><p>1928年4月后，二人的争论从理论走向全会和公开化。最初布哈林在党内占据优势，但是斯大林已经掌握最高权力，“多数派”的意见已经逐渐不起作用。7月全会上，斯大林提出“贡税论”，即农民必须为实现工业化而缴纳“贡税”，得到了大多数人的默许，形势发生逆转。7月全会也成为布哈林从理论上占优势转而走向失败的转折点。斯大林的理论归根到底就是，农民缴纳贡税，工人阶级建设工业化的国家。</p><p>布哈林不愿低头认输。1928年9月30日，他在《真理报》发表《一个经济学家的札记》，猛烈批评“贡税论”：群众迫切需要了解事情的真实情况，不满老掉牙的、死板的空话；斯大林的“贡税论”就是普列奥布拉任斯基的“社会主义原始积累论”。布哈林的坚定支持者、布鲁诺精神的继承者——莫斯科党委书记乌格兰诺夫被斯大林严厉批判与撤职，将斯大林与布哈林的争论推到了最后关头。1929年初联席会议上，布哈林仍被给予最后一次“和解方案”，因为斯大林可能并不希望用解决托洛茨基、季诺维耶夫、加米涅夫的方式解决布哈林。但布哈林不仅拒绝一切委曲求全的方案，还起草了一份批驳斯大林政策的声明，并由李可夫在政治局会议上宣读，直指斯大林用个人决定代替党的集体领导原则。2月9日，斯大林正式在全国开启“反右倾斗争”。</p><p>苏联的反右倾斗争从根本上彻底粉碎了民主的可能性，之后发生的农业集体化、大饥荒、大清洗都是必然结果。集权国家毁灭的直接原因并不是由于理论思想的极端性与不可实现性，而是随着时间的推移，继任的当权者和他的爪牙们甚至连最基本的理论都搞不懂，他们只会重复没有任何意义的废话！即比起坚定的乌托邦式信仰，信仰的崩塌才是导致社会主义道路一直以来行不通的外在原因。</p>]]></content>
      
      
      <categories>
          
          <category> 历史 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 苏联史 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>大迁移——苏联的特殊移民政策及其后果</title>
      <link href="/posts/2664/"/>
      <url>/posts/2664/</url>
      
        <content type="html"><![CDATA[<p>本篇文献来自《一个大国的崛起与崩溃——苏联历史专题研究（1917-1991）》，作者为咸阳西藏民族学院的师建军</p><p>文章的第一部分就直接点明，苏联当局在特殊移民政策实施过程中的违法乱纪、蔑视人权、践踏人类道德的行径充分暴露了斯大林模式的深刻弊端，是导致苏联解体以及后来民族纷争的重大原因之一</p><h1>特殊移民</h1><p>特殊移民泛指1930~1953年被迫迁移的约600万人，主要包括30年代初全盘集体化时期的富农和30年代中期后大规模驱逐的少数民族。而特殊移民又是斯大林时期“特殊人口”的一部分，后者包含囚犯、政治犯、拘留民、检查-过滤营犯人、劳改犯、行政移民和特殊移民。特殊移民的地位居于普通公民和其他特殊人口之间，在移民区内能够自由通行，但没有选举权（1936年后名义上恢复），扣除5%的工资用于支付移民区管理费用（1944年后取消）。特殊移民内部，富农和少数民族的待遇也有很大的不同，例如富农的子女在16岁以上且到外地上学的会撤销特殊移民身份，而少数民族则不可以。</p><blockquote><p>拘留民：有通敌嫌疑的人，会被发往特殊移民区，检查-过滤营犯人与之类似<br>行政移民：与特殊移民类似（可能被随时转为特殊移民），名义上拥有完整的公民权，可以自由出入移民区，只是不得返回原迁出地</p></blockquote><p>1930年的全盘集体化政策将富农分为三类，第一类直接被逮捕；第二类和第一类的家属被发往特殊移民区；第三类由州/边疆区处置。斯大林通过流放富农获得了大量资金，并且弥补了边疆劳动力的不足。进入40年代，农业集体化实现，战争的爆发使得民族问题上升为“主要矛盾”，在富农管制逐渐放松的背景下，民族流放愈演愈烈。</p><p>1950-1953年苏共中央就能够从民情分析资料中感受到危机的存在，连续多年的镇压和政治运动早已是人心丧失殆尽。另一个原因是，苏联部长会议认为，即使取消了迁移限制，特殊移民由于已经习惯了当地生活也不会离开移民区，“殖民成果”已经达成。到1965年，特殊移民人口降至1万人以下，人身限制问题已经基本解决。</p><h1>罄竹难书</h1><h2 id="农业集体化">农业集体化</h2><p>特殊移民政策起始于农业集体化时期对富农的流放。农民被迫交出土地和生产资料，许多人为了止损会把牲畜都宰杀掉。直到1953年，苏联畜牧业都低于集体化之前的水平，粮食产量甚至不如1913年的水平，这是对斯大林农业模式最无情的批判。造成这种结果的直接原因包括以下几点：</p><ul><li>流放造成农村人口尤其是勤劳能干、文化水平高的中农的减少</li><li>自主经营权的丧失造成懒散风气盛行</li><li>“以穷为荣”的社会风气导致没有人敢劳动</li></ul><blockquote><p>关于农业集体化请参考本站《农业集体化运动》</p></blockquote><h2 id="民族冲突">民族冲突</h2><p>大迁移不仅对无数人的生活造成极大的影响，更让本身就脆弱的民族关系雪上加霜。如1957年车臣人和印古什人要求搬回原址，从而与现有的其他种族居民发生冲突，大批俄罗斯族人外逃。自此以后，民族冲突不断，并引发多次大规模战争，包括奥赛梯-印古什战争、两次车臣战争等。俄罗斯族等其他种族的迁移者同样是非自愿的，他们也是苏联反人类流放的受害者。苏共低下的执政能力使得原本是好意的回归政策进一步加深了民族隔阂。</p><p>在二十大后解禁的大环境下，面对民族自治呼声，赫鲁晓夫采用的解决方案仍然延续了斯大林的沙文主义风格，大肆镇压要求民族自主权的活动。如60年代兴起的乌克兰地下组织“乌克兰民族阵线”、“乌克兰工农联盟小组”等主张维护乌克兰共和国的独立自主权，保护本民族文化，被批判为“资产阶级民族主义”。1972年乌克兰第一书记谢列斯特因撰写歌颂乌克兰文化的《我们的苏维埃乌克兰》一书被免职。1968年克里木鞑靼人举行要求返回故乡的示威活动，有300多人被逮捕。</p><h2 id="深远影响">深远影响</h2><p>1930-1933年大饥荒和特殊移民流放造成农村人口的大量流失以及新生儿的夭折，使农村人口在30年代的10年间减少三分之一以上，对俄国人口结果造成毁灭性打击，并且一直延续至今。由于问题的根源——system没有改变，斯大林反人类罪行的恶果在他死后也未曾被抹去。农业的停滞不前造成70年代苏联供需极不平衡，国民经济的畸形发展越来越严重。苏联的人均耕地面积比美国还高5%，但每年仍要大量进口粮食。另一方面，民族冲突使得改革难以推进。更为致命的是，个人意识、创新思维和主动精神的丧失导致戈尔巴乔夫那样的表面改革根本无法发挥作用。在1990年对农民的调查结果显示，竟然有半数以上的人不知道离开集体农庄后如何生活。因此将苏联的崩溃归咎于戈尔巴乔夫的改革是极其幼稚的。</p><p>尽管客观上来说特殊移民确实促进了苏联中东部地区的发展和国家工业化，但是这种进步建立在残酷剥削和血腥统治的基础上，手段之残忍绝不亚于资本主义国家的原始积累过程。在《在市场经济和计划经济的十字路口——新经济政策研究（1921-1929）》中写道，左派领导人都是急性子，他们信奉急功近利、竭泽而渔的管理模式，而就是这种不顾客观规律的短视思维毁了苏联。</p><blockquote><p>关于社会主义国家的资本积累过程，参考本站《国家工业化》</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 历史 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 苏联史 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>政治危机中苏俄国家功能的转化——喀琅施塔得事件始末</title>
      <link href="/posts/25139/"/>
      <url>/posts/25139/</url>
      
        <content type="html"><![CDATA[<p>本篇来自《一个大国的崛起与崩溃——苏联历史专题研究（1917-1991）》，作者为华东师范大学的朱小萍和余伟民</p><p>苏俄官方定性：受外国势力支持的白卫军分子、社会革命党人和无政府主义者发动的反革命叛乱<br>俄罗斯定性：事件参与者无罪，并修建纪念碑</p><h1>背景</h1><p>战时共产主义被视为直接向社会主义（共产主义）过渡的政策而在国内战争基本结束后大加推广：在农村实行连环保；将500万军队改编为劳动军；严惩逃跑现象，直至关进集中营；并且延伸至工业和经济领域。这种“捷径”造成1920-1921年苏俄空前的政治经济危机：农业和工业远低于一战前甚至19世纪末的水平；商业国有化造成黑市泛滥，经济状况极度恶化。1920年底后农民暴动遍及全国。官方报告中称：现在的农民暴动不同于旧式农民暴动的一点在于，现在的农民暴动具有组织性和计划性。商品的极度匮乏亦引起工人对苏维埃政权的怀疑与失望。1921年初各大工业城市相继爆发规模不等的工人骚乱。国内战争期间，喀琅施塔得海军基地的许多士兵前往战场，而后补部队多来自农村。他们与农村保持着密切的联系，很清楚农村发生的灾难。喀琅施塔得事件就是在这样的背景下发生的。</p><h1>事件的发生</h1><h2 id="前奏——彼得格勒工人暴动">前奏——彼得格勒工人暴动</h2><p>1921年2月21日，彼得格勒特鲁博奇工厂提出取消共产党专政和建立自由选举的苏维埃政权，遭到当局的拒绝。2月24日，特鲁博奇工厂联合其他工厂的共2500人进行游行示威，要求言论、出版、集会自由。次日，彼得格勒当局宣布游行为叛国行为，派军事学院学生进行镇压。2月28日，联共布中央下令逮捕右派分子。彼得格勒工人暴动对于喀琅施塔得海军部队本就不慢的情绪无异于火上浇油。内战结束后，士兵始终无法复员；粮食状况恶化；军纪越来越严，而军官特权日亦膨胀；通过来信得知农村情况不容乐观；大批士兵退党，一切的因素都在促使革命的爆发。2月27日，多艘战舰的士兵举行集会，并提出多项改革要求。主要内容如下：</p><ol><li>由于现有苏维埃未能反应农民和工人的意志，应立即通过无记名投票的形式改组苏维埃，并在此之前实行宣传自由</li><li>要求言论、出版、集会、组织工会和农民联合会的自由</li><li>尽快召开工人和士兵的无党派会议</li><li>释放所有政治犯</li><li>选举专门委员会重新审理集中营囚犯</li><li>取消政治部，组织成立地方选举产生的国民文化教育委员会，因为任何一个政党都可能利用特权宣传自己的思想，并用国家工具达到目的</li><li>撤销所有征粮队</li><li>除有害车间外，所有工人的供应份额相等</li><li>给予农民土地的完全使用权</li></ol><p>上述决议的提出被视为喀琅施塔得事件的开始。3月1日，第一和第二战列舰支队高票通过上述决议。当晚曾有人提议逮捕加里宁作为人质，但大多数人表示反对。3月2日，临时革命委员会逮捕大批共产党员，并基本占领喀琅施塔得。他们声称：“执掌国家政权的共产党脱离群众，已无力拯救国家于全面崩溃之中。它不重视工人们提出的要求，而且认为这些要求是反革命的阴谋，共产党实在是大错特错了。这些骚动，这些要求是所有人民，所有劳动者的心声。”3月3日，喀琅施塔得大批党员退党，甚至在报纸上公开表示对党的深深失望。革命的士兵起初相信政府会与他们妥协，因为他们要求的自由选举本就是苏维埃的必然结果，且自由的苏维埃与十月革命中布尔什维克的口号是一致的。但是经过解散立宪会议和国内战争，布尔什维克已经牢牢掌握政权，不可能再与任何其它政党或组织分享权力（无论是否通过自由选举的形式）。3月4日，临时革命委员会预感政府即将发动进攻，因此紧急宣布进入战争状态。</p><h2 id="中央政府的反应">中央政府的反应</h2><p>早在事件爆发前，中央政府就已经关注到波罗的海舰队，特别是喀琅施塔得驻军的骚动，他们通过充当“秘密警察”的共产党员获取疑似反革命者的信息，并采取一定措施阻止不满情绪的扩散。事件爆发后，俄共布高层一致认为其与政治反对派和外国帝国主义有关。3月2日，中央政府军队控制了喀琅施塔得周边的战略要地。同日苏维埃彼得格勒委员会宣布喀琅施塔得事件为反革命叛变。很显然，高层并不是，也不可能真的认为外国和反对派势力在其中起决定性作用。将其与白卫军联系在一起只是为了争取大部分俄国人的同情和支持，防止叛乱溢出。3月4日，彼得格勒国防委员会逮捕了叛变士兵的亲属，并声称如果喀琅施塔得被控制的共产党员“哪怕是头发掉了一根，上述人质将会人头落地”。临时革命委员会称，即使处于极端的仇恨中，这样的逮捕也是最无耻和卑鄙的。</p><p>中央政府控制了舆论，阻止了革命的外泄，这是起义失败的关键原因。这也在一定程度上说明，没有新闻自由，就绝对不会有真正的法治、民主。正如喀琅施塔得决议中所写的一样，一党专制实际上是对新闻和思想的绝对掌控，也就绝对不会带有任何意义上的民主色彩。3月8日，政府军进攻喀琅施塔得。俄共布十大也于此日召开，正式标志着“战时共产主义”的终结和新经济政策的开始。共产党可能会在一定程度上做出妥协，但是绝不允许一般民众提出建议，更不能容忍政权受到威胁。政府和起义者本可以达成妥协，因为取消战时共产主义政策是喀琅施塔得起事者最根本的要求。他们这样做只有一个目的——巩固布尔什维克政权。十大宣布用粮食税取代余粮收集制，是迫于客观形势的需要。但是布尔什维克只会在经济上妥协，但是对于“自由、平等地重新选举苏维埃”这种政治诉求决不妥协，这就是列宁的原则。十大的决策可以总结为：经济上趋于宽松，政治上趋于集中。这是列宁思想最大的问题所在：他认为只要方向正确，党的集中领导将战无不胜。可是“领导一切”的党不允许有任何杂音出现，因此一旦方向错误，任何的“努力”都将会造成巨大的灾难。</p><p>3月17日，政府军对喀琅施塔得发起总攻，次日完全占领城市，大概有8000人逃亡芬兰。随着起义的失败，惩罚也随之开始。众多事件参与者被处以极刑或关进集中营。即使是逃亡芬兰的革命委员会成员也在不久后被逮捕。布尔什维克在城内进行身份登记，将大量相关人员及起事者亲属流放。</p><h1>尾声</h1><p>1921年苏俄内部报告表明：侦查材料无法确定，在兵变发生之前，反革命组织在要塞指挥人员中做过什么工作，也没发现协约国间谍的活动，运动的整个过程都没有说明有这样的可能。这是目前最为正确和坦率的结论。喀琅施塔得事件是苏维埃政权从理想型的无产阶级专政走向现实政治国家的标志性事件。出于巩固政权需要的镇压一旦背离了社会公众的选择取向，就会发生不以人们意志为转移的国家权力机制的蜕变。在没有建立起制衡机制的情况下，为斯大林主义埋下了伏笔。</p>]]></content>
      
      
      <categories>
          
          <category> 历史 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 苏联史 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>numpy</title>
      <link href="/posts/14982/"/>
      <url>/posts/14982/</url>
      
        <content type="html"><![CDATA[<h1>2023.3.30</h1><h2 id="矩阵构建">矩阵构建</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">a = np.zeros(<span class="number">10</span>).astype(<span class="string">&#x27;float64&#x27;</span>)</span><br><span class="line">a = np.ones(<span class="number">10</span>).astype(<span class="string">&#x27;int8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">x3 = (np.arange(<span class="number">10</span>)==<span class="number">4</span>).astype(<span class="string">&#x27;int8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">np.array(<span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">10</span>,<span class="number">20</span>)))[::-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">np.identity(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">b = np.repeat(<span class="number">0</span>,<span class="number">10</span>).reshape(<span class="number">2</span>,-<span class="number">1</span>)</span><br><span class="line"><span class="comment"># reshape第二参数的-1表示依照第一参数自动进行划分</span></span><br></pre></td></tr></table></figure><h2 id="使用random构建随机矩阵">使用random构建随机矩阵</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">np.random.random((<span class="number">3</span>,<span class="number">4</span>))</span><br><span class="line">a = np.random.random((<span class="number">10</span>,))</span><br><span class="line"></span><br><span class="line">np.random.uniform(<span class="number">5</span>,<span class="number">11</span>,size=(<span class="number">5</span>,<span class="number">3</span>))</span><br><span class="line"></span><br><span class="line">np.random.seed(<span class="number">5</span>)</span><br><span class="line"><span class="comment"># 设置随机种子</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 随机选择行或列</span></span><br><span class="line">a = np.arange(<span class="number">20</span>).reshape([<span class="number">4</span>,<span class="number">5</span>])</span><br><span class="line">mini = np.random.choice(a.shape[<span class="number">0</span>],<span class="number">2</span>,replace=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 小技巧：构建对数尺度范围内的随机值</span></span><br><span class="line"><span class="number">10</span>**np.random.uniform(-<span class="number">3</span>,<span class="number">3</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>random模块中，random函数返回[0,1)的随机值，uniform返回 [a,b]的随机值，randint返回[a,b]的随机整数值</p></blockquote><h2 id="索引指定元素">索引指定元素</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检索非零元素，返回的是index</span></span><br><span class="line">np.nonzero(np.array([<span class="number">1</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">3</span>]))</span><br><span class="line">np.where(np.array([<span class="number">1</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">3</span>]) !=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#! 创建一个边界为1，内部为0的矩阵</span></span><br><span class="line">b = np.ones((<span class="number">5</span>,<span class="number">4</span>))</span><br><span class="line">b[<span class="number">1</span>:-<span class="number">1</span>,<span class="number">1</span>:-<span class="number">1</span>] = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#! 提取元素</span></span><br><span class="line"><span class="comment">#* 并列筛选条件必须加小括号</span></span><br><span class="line">a = np.array([<span class="number">2</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">3</span>, <span class="number">27</span>])</span><br><span class="line">a[(<span class="number">5</span>&lt;=a) &amp; (a&lt;=<span class="number">10</span>)]</span><br><span class="line">a[np.where((a&gt;=<span class="number">5</span>) &amp; (a&lt;=<span class="number">10</span>))]</span><br></pre></td></tr></table></figure><p>where函数有三个参数：</p><ol><li>bool判断条件</li><li>true时的返回值</li><li>false时的返回值</li></ol><h2 id="矩阵参数的获取">矩阵参数的获取</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a.<span class="built_in">min</span>() </span><br><span class="line">a.mean()</span><br><span class="line">np.<span class="built_in">max</span>(a)</span><br></pre></td></tr></table></figure><h2 id="矩阵操作">矩阵操作</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! 交换行/列</span></span><br><span class="line">a = np.arange(<span class="number">16</span>).reshape(<span class="number">4</span>,-<span class="number">1</span>)</span><br><span class="line">a[[<span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">0</span>],:]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 颠倒行/列</span></span><br><span class="line">a = np.arange(<span class="number">16</span>).reshape(<span class="number">4</span>,-<span class="number">1</span>)</span><br><span class="line">a[::-<span class="number">1</span>,::-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 堆叠矩阵</span></span><br><span class="line">a = np.arange(<span class="number">10</span>).reshape(<span class="number">2</span>,-<span class="number">1</span>)</span><br><span class="line">b = np.repeat(<span class="number">0</span>,<span class="number">10</span>).reshape(<span class="number">2</span>,-<span class="number">1</span>)</span><br><span class="line">np.vstack([a,b])</span><br><span class="line">np.hstack([a,b])</span><br></pre></td></tr></table></figure><h1>矩阵显示</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">np.set_printoptions(threshold=np.inf)       </span><br><span class="line"><span class="comment"># 列数过多时确保全部元素都能显示出来</span></span><br></pre></td></tr></table></figure><h1>概念</h1><h2 id="维度和维度数">维度和维度数</h2><p>维度和维度数是两个不同的概念，维度与shape相关，维度数与ndim相关</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a = np.random.random([<span class="number">28</span>,<span class="number">28</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.ndim</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.shape</span><br><span class="line">(<span class="number">28</span>, <span class="number">28</span>)</span><br></pre></td></tr></table></figure><h1>一维数组和二维数组</h1><p>(1,5)和(5,)是两个不同的概念！前者为二维矩阵，后者为一维数组，即shape和ndim不同</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">a = np.arange(<span class="number">6</span>)</span><br><span class="line">b= a.reshape(<span class="number">1</span>,-<span class="number">1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.ndim</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b.ndim</span><br><span class="line"><span class="number">2</span></span><br></pre></td></tr></table></figure><p><strong>一维数组和二维数组的索引方法不同</strong></p>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 神经网络 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>深度学习(2)——神经网络</title>
      <link href="/posts/35526/"/>
      <url>/posts/35526/</url>
      
        <content type="html"><![CDATA[<p>参考书目：深度学习入门(1)·斋藤康毅</p><h1>激活函数</h1><p>激活函数的作用就是对加权输入信号和偏置的总和进行函数处理，使之变为输出信号。单层感知机（朴素感知机）的激活函数为阶跃函数，如果将其替换为其他的激活函数，就会进化为神经网络。例如比较常用是sigmoid函数和ReLU函数：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>h</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>1</mn><mo>+</mo><mi>e</mi><mi>x</mi><mi>p</mi><mo stretchy="false">(</mo><mo>−</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">h(x)=\frac{1}{1+exp(-x)} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">h</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.2574em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord">−</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mrow><mo fence="true">{</mo><mtable rowspacing="0.36em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>x</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mtext>x&gt;0</mtext></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mtext>x&lt;=0</mtext></mstyle></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex"> f(x)=\begin{cases}x&amp; \text{x&gt;0}\\0&amp; \text{x&lt;=0}\end{cases} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:3em;vertical-align:-1.25em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.69em;"><span style="top:-3.69em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathnormal">x</span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.19em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.69em;"><span style="top:-3.69em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord text"><span class="mord">x&gt;0</span></span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord text"><span class="mord">x&lt;=0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.19em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>阶跃函数、sigmoid函数和ReLU函数的python实现如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">step_function</span>(<span class="params">a</span>):</span><br><span class="line">    <span class="keyword">return</span> np.array(a&gt;<span class="number">0</span>,dtype=np.int32)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sigmoid</span>(<span class="params">b</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> / (<span class="number">1</span>+np.exp(b))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">relu</span>(<span class="params">c</span>):</span><br><span class="line">    <span class="keyword">return</span> np.maximum(<span class="number">0</span>,c)</span><br></pre></td></tr></table></figure><p>输出层的激活函数与隐藏层不同，包括恒等函数和softmax函数。恒等函数一般用于回归问题，softmax函数一般用于分类问题。softmax函数的输出值介于0-1之间，可以看成概率，其大小关系与输出层的输入信号一致。因此学习过程使用softmax函数，但推理过程无需使用。</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>y</mi><mi>k</mi></msub><mo>=</mo><mfrac><mrow><mi>e</mi><mi>x</mi><mi>p</mi><mo stretchy="false">(</mo><msub><mi>a</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow><mrow><mo>∑</mo><mi>e</mi><mi>x</mi><mi>p</mi><mo stretchy="false">(</mo><msub><mi>a</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">y_k = \frac{exp(a_k)}{\sum exp(a_i)}  </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.363em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">softmax</span>(<span class="params">d</span>):</span><br><span class="line">    d_max = np.<span class="built_in">max</span>(d)</span><br><span class="line">    <span class="keyword">return</span> np.exp(d-d_max) / np.<span class="built_in">sum</span>(np.exp(d-d_max))</span><br><span class="line"><span class="comment">#! 这里考虑了输入信号过大可能导致指数计算时出现错误</span></span><br></pre></td></tr></table></figure><h1>学习</h1><h2 id="loss-function">loss function</h2><p>神经网络的学习完全基于原始数据，而普通的机器学习（如支持向量机）则依赖于人工对原始数据的特征化处理，因此神经网络（深度学习）不存在人为介入</p><p>学习的指标统称为损失函数（loss function），常用的包括均方误差和交叉熵误差</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>E</mi><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mo>×</mo><munder><mo>∑</mo><mi>k</mi></munder><mo stretchy="false">(</mo><msub><mi>y</mi><mi>k</mi></msub><mo>−</mo><msub><mi>t</mi><mi>k</mi></msub><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">E=\frac{1}{2}\times \sum_{k}(y_k-t_k)^2 </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.3521em;vertical-align:-1.3021em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.05em;"><span style="top:-1.8479em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.3021em;"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1141em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>E</mi><mo>=</mo><mo>−</mo><munder><mo>∑</mo><mi>k</mi></munder><msub><mi>t</mi><mi>k</mi></msub><mi>l</mi><mi>n</mi><mtext> </mtext><msub><mi>y</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">E=-\sum_k t_kln\,y_k </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.3521em;vertical-align:-1.3021em;"></span><span class="mord">−</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.05em;"><span style="top:-1.8479em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.3021em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy</span><br><span class="line"></span><br><span class="line">y = numpy.array([<span class="number">0.1</span>,<span class="number">0.2</span>,<span class="number">0.6</span>,<span class="number">0.1</span>,<span class="number">0</span>])</span><br><span class="line">t = numpy.array([<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">#? 均方误差</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mean_squared_error</span>(<span class="params">y,t</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0.5</span>*numpy.<span class="built_in">sum</span>((y-t)**<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#? 交叉熵误差</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cross_entropy_error</span>(<span class="params">y,t</span>):</span><br><span class="line">    delta = <span class="number">10e-7</span></span><br><span class="line">    <span class="keyword">return</span> -numpy.<span class="built_in">sum</span>(t*numpy.log(y+delta))</span><br><span class="line"></span><br><span class="line">mean_squared_error(y,t)</span><br><span class="line">cross_entropy_error(y,t)</span><br></pre></td></tr></table></figure><blockquote><p>以上公式针对单个训练数据，k为数据的维数，y为训练结果，t为训练数据<br>理论上需要对所有训练数据的损失函数求平均取平均损失函数，但考虑到数据量过大，选取一部分mini-batch进行多次训练</p></blockquote><p><strong>为什么设置损失函数，而不是以accuracy作为指标？</strong></p><p>核心问题：accuracy是一个离散值，当微调参数时，accuracy不一定发生变化（即accuracy对参数的导数值为0），无法指导我们修改参数</p><h2 id="学习步骤">学习步骤</h2><ol><li>学习数据和测试数据获取</li><li>构建神经网络</li><li>对每一个mini-batch计算梯度，并更新参数</li><li>在学习过程中记录accuracy，观察是否出现过拟合</li></ol><h1>随机梯度下降法</h1><p><strong>梯度指向函数下降最快的方向，而不一定是最小值方向</strong>。因此需要不断地在新点位计算梯度，并沿着新梯度前进。在神经网络中，使用的是损失函数对参数的梯度：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>w</mi><mi>n</mi></msub><mo>=</mo><msub><mi>w</mi><mi>n</mi></msub><mo>−</mo><mi>η</mi><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>f</mi></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>x</mi><mi>n</mi></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">w_n = w_n - \eta\frac{\partial f}{\partial x_n}  </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.2074em;vertical-align:-0.836em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">η</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.836em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>其中：w为参数，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>η</mi></mrow><annotation encoding="application/x-tex">\eta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">η</span></span></span></span> 为<strong>学习率（learning rate）</strong>，f为损失函数。学习率是也是神经网络的参数，但与权重和偏置不同，学习率需要人为指定，因此称为超参数。stable diffusion中的lr就是学习率。梯度获取最简单的方法是数值微分中的中心差分思想，但是真的慢！下一节的误差反向传播法的速度能够快很多。</p><h1>误差反向传播法</h1><p>误差反向传播法是一种快速的梯度获取方法</p><h2 id="理论基础">理论基础</h2><p>误差反向传播法基于偏导数中的链式法则</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>L</mi></mrow><mrow><mi mathvariant="normal">∂</mi><mi>X</mi></mrow></mfrac><mo>=</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>L</mi></mrow><mrow><mi mathvariant="normal">∂</mi><mi>Y</mi></mrow></mfrac><mo>⋅</mo><msup><mi>W</mi><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">\frac{\partial L}{\partial X}= \frac{\partial L}{\partial Y}\cdot W^T  </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.0574em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.0574em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8913em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>L</mi></mrow><mrow><mi mathvariant="normal">∂</mi><mi>W</mi></mrow></mfrac><mo>=</mo><msup><mi>X</mi><mi>T</mi></msup><mo>⋅</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>L</mi></mrow><mrow><mi mathvariant="normal">∂</mi><mi>Y</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{\partial L}{\partial W}= X^T \cdot \frac{\partial L}{\partial Y} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.0574em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8913em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.0574em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>偏置的偏导数有些特殊：L对Y的偏导数是一个N行矩阵，而偏置的行数应该是1，因此需要按列求和(axis=0)</p><p><strong>计算要点</strong></p><ol><li>分支(repeat)节点：正向传播时有n个分支流出，则反向传播时需要对n个输入信号求和</li><li>并入(sum)节点：正向有并入求和过程，反向无需分离，相当于分支节点的正过程</li></ol><blockquote><p>应用：softmax_loss层推导<br>上述内容来自《深度学习进阶：自然语言处理》的第一章，但是非常有用</p></blockquote><h2 id="层构建">层构建</h2><p>基于面向对象思想构建神经网络的层结构，包括激活函数、加权层（affine）和输出层（激活函数+loss）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#* 乘法层</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">mulayer</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.x = <span class="literal">None</span></span><br><span class="line">        self.y = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self,x,y</span>):</span><br><span class="line">        self.x = x</span><br><span class="line">        self.y = y</span><br><span class="line">        out = x*y</span><br><span class="line">        <span class="keyword">return</span> out</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">backward</span>(<span class="params">self,dout</span>):</span><br><span class="line">        dx = dout*self.y</span><br><span class="line">        dy = dout*self.x</span><br><span class="line">        <span class="keyword">return</span> dx,dy</span><br><span class="line"></span><br><span class="line">apple = mulayer()</span><br><span class="line">tax = mulayer()</span><br><span class="line">a1 = apple.forward(<span class="number">100.0</span>,<span class="number">2.</span>)</span><br><span class="line">a2 = tax.forward(a1,<span class="number">1.1</span>)</span><br><span class="line"><span class="built_in">print</span>(a2)</span><br><span class="line">dout = <span class="number">1</span></span><br><span class="line">b1,b2 = tax.backward(dout)</span><br><span class="line">b3,b4 = apple.backward(b1)</span><br><span class="line"><span class="built_in">print</span>(b1,b3)</span><br><span class="line"></span><br><span class="line"><span class="comment">#* 加法层</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">prolayer</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self,x,y</span>):</span><br><span class="line">        <span class="keyword">return</span> x+y</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">backward</span>(<span class="params">self,dout</span>):</span><br><span class="line">        <span class="keyword">return</span> dout,dout</span><br><span class="line"></span><br><span class="line"><span class="comment">#* relu层</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">relulayer</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self,a</span>):</span><br><span class="line">        <span class="keyword">return</span> np.maximum(a,<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">backward</span>(<span class="params">self,dout</span>):</span><br><span class="line">        <span class="keyword">return</span> np.where(dout&gt;<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>)</span><br><span class="line">    </span><br><span class="line">a = relulayer()</span><br><span class="line">a.forward(np.arange(-<span class="number">4</span>,<span class="number">5</span>).reshape([<span class="number">3</span>,<span class="number">3</span>]))</span><br><span class="line">a.backward(np.arange(-<span class="number">4</span>,<span class="number">5</span>).reshape([<span class="number">3</span>,<span class="number">3</span>]))</span><br><span class="line"></span><br><span class="line"><span class="comment">#* sigmoid层</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">sigmoidlayer</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.y = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self,x</span>):</span><br><span class="line">        self.y = <span class="number">1</span> / (<span class="number">1</span>+np.exp(-x))</span><br><span class="line">        <span class="keyword">return</span> self.y</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">backward</span>(<span class="params">self,dout</span>):</span><br><span class="line">        <span class="keyword">return</span> dout*self.y*(<span class="number">1.0</span>-self.y) <span class="comment">#type:ignore</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#! affine层</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">affine</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,w,b</span>):</span><br><span class="line">        self.x = <span class="literal">None</span></span><br><span class="line">        self.w = w</span><br><span class="line">        self.b = b</span><br><span class="line">        self.dw = <span class="literal">None</span></span><br><span class="line">        self.db = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self,x</span>):</span><br><span class="line">        self.x = x</span><br><span class="line">        <span class="keyword">return</span> np.dot(self.x,self.w)+self.b</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">backward</span>(<span class="params">self,dout</span>):</span><br><span class="line">        self.dw = np.dot(self.x.T,dout)<span class="comment">#type:ignore</span></span><br><span class="line">        self.db = np.<span class="built_in">sum</span>(dout,axis=<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> np.dot(dout,self.w.T)</span><br><span class="line"></span><br><span class="line"><span class="comment">#! softmax_losslayer</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">softmax_losslayer</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.loss = <span class="literal">None</span></span><br><span class="line">        self.y = <span class="literal">None</span></span><br><span class="line">        self.t = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self,x,t</span>):</span><br><span class="line">        self.y = softmax(x)</span><br><span class="line">        self.t = t</span><br><span class="line">        self.loss = cross_entropy_error(self.y,self.t)</span><br><span class="line">        <span class="keyword">return</span> self.loss</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">backward</span>(<span class="params">self,dout</span>):</span><br><span class="line">        batch_size = self.t.shape[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">return</span> (self.y-self.t) / batch_size</span><br></pre></td></tr></table></figure><h2 id="神经网络构建">神经网络构建</h2><p>有了上述的层结构，就可以构建神经网络了。由于需要进行正向和反向操作，选择有序数据类型是必要的。python3.7后dict是有序数据，与ordereddict的用法比较接近，但是考虑到兼容性，仍然使用ordereddict</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> OrderedDict</span><br><span class="line">a = OrderedDict()</span><br><span class="line">a[<span class="string">&#x27;one&#x27;</span>] = <span class="number">1</span></span><br><span class="line">a[<span class="string">&#x27;two&#x27;</span>] = <span class="number">2</span></span><br><span class="line">a[<span class="string">&#x27;three&#x27;</span>] = <span class="number">3</span></span><br><span class="line"><span class="keyword">for</span> value <span class="keyword">in</span> <span class="built_in">reversed</span>(a.values()):</span><br><span class="line">    <span class="built_in">print</span>(value)</span><br><span class="line">    </span><br><span class="line">a = &#123;&#125;</span><br><span class="line">a[<span class="string">&#x27;one&#x27;</span>] = <span class="number">1</span></span><br><span class="line">a[<span class="string">&#x27;two&#x27;</span>] = <span class="number">2</span></span><br><span class="line">a[<span class="string">&#x27;three&#x27;</span>] = <span class="number">3</span></span><br><span class="line"><span class="keyword">for</span> value <span class="keyword">in</span> <span class="built_in">reversed</span>(a.values()):</span><br><span class="line">    <span class="built_in">print</span>(value)</span><br><span class="line"></span><br><span class="line"><span class="comment">#以上代码在3.8.6中均可运行</span></span><br></pre></td></tr></table></figure><p>神经网络构建包括层组装和梯度获取两部分，前者使用上一小节建立的层结构和ordereddict构建，后者将各affine层的梯度汇总，然后更新参数。</p><h1>参数更新</h1><p>参数更新的核心数据是损失函数对参数的梯度，前面的两节中，都是基于随机梯度下降法（SGD），而如何更好地使用梯度就是本节的问题。</p><h2 id="SGD">SGD</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SGD</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,lr=<span class="number">0.01</span></span>):</span><br><span class="line">        self.lr = lr</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">self,params,grads</span>):</span><br><span class="line">        <span class="keyword">for</span> key <span class="keyword">in</span> params.keys():</span><br><span class="line">            params[key] -= self.lr*grads[key]</span><br></pre></td></tr></table></figure><p>SGD的问题在<strong>梯度不一定指向最小值方向</strong></p><h2 id="momentum">momentum</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! momentum</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">momentum</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,a=<span class="number">0.9</span>,lr = <span class="number">0.1</span></span>):</span><br><span class="line">        self.a = a</span><br><span class="line">        self.lr = lr</span><br><span class="line">        self.v = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">self,params,grads</span>):</span><br><span class="line">        <span class="keyword">if</span> self.v == <span class="literal">None</span>:</span><br><span class="line">            self.v = &#123;&#125;</span><br><span class="line">            <span class="keyword">for</span> key,value <span class="keyword">in</span> params.items():</span><br><span class="line">                self.v[key] = np.zeros_like(value)</span><br><span class="line">        <span class="keyword">for</span> key <span class="keyword">in</span> params.keys():</span><br><span class="line">            self.v[key] = self.v[key]*self.a-self.lr*grads[key]</span><br><span class="line">            params[key] += self.v[key]</span><br></pre></td></tr></table></figure><p>momentum记录了之前所有的梯度，因此可以抵消震荡导致的低效率。</p><h2 id="adagrad">adagrad</h2><p>adagrad比momentum更进一步，使用梯度参数改变学习率。具体来说，梯度越大的参数，学习率将减小。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! adagrad</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">adagrad</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,lr = <span class="number">0.1</span></span>):</span><br><span class="line">        self.h = <span class="literal">None</span></span><br><span class="line">        self.lr = lr</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">self,params,grads</span>):</span><br><span class="line">        <span class="keyword">if</span> self.h == <span class="literal">None</span>:</span><br><span class="line">            self.h = &#123;&#125;</span><br><span class="line">            <span class="keyword">for</span> key,value <span class="keyword">in</span> params.items():</span><br><span class="line">                self.h[key] = np.zeros_like(value)</span><br><span class="line">        <span class="keyword">for</span> key <span class="keyword">in</span> params.keys():</span><br><span class="line">            self.h[key] += grads[key]*grads[key]</span><br><span class="line">            params[key] -= self.lr*grads[key]/(np.sqrt(self.h[key])+<span class="number">1e-7</span>)</span><br></pre></td></tr></table></figure><blockquote><p>*和/代表对应矩阵元素的运算</p></blockquote><p>adagrad的优点是对于梯度很大的噪音（例如震荡梯度）可以很好地去除，但是如果损失函数噪音很小，会导致学习率迅速下降，以至于无法更新。</p><h2 id="其他">其他</h2><p>基于adafrad和momentum还有RMSprop和adam算法等，本书只是给出了代码但没有解释。简单来说，RMSprop能够在一定程度上解决adagrad学习率迅速下降的问题，adam则融合了adafrad和momentum。</p><p><strong>参数的更新方法没有elixir，每种方法都有适用条件，例如许多人还在使用SGD</strong></p><h1>权重初始化</h1><p>之前的学习中，权重都是使用np.random.randn获得的，其含义是建立符合高斯分布的随机参数矩阵。值得注意的是，一般还会乘以一个系数（例如1或0.1），这个系数对权重的初始化意义重大。如果系数过大（如1），输入信号在经过激活层后的信号分布集中于边界处。以sigmoid函数为例，输出信号集中于0和1附近。由于sigmoid函数在0、1附近的梯度接近于0，会产生梯度消失现象。如果系数过小（0.01以下），输出信号会集中于0.5附近。这样虽然避免了梯度消失，但是单一化的权重限制了多神经元的表现力。如果权重为零矩阵，第二层神经元的输入值相同（？？？），则反向传播时全部权重会进行相同的更新，神经网络失效。</p><blockquote><p>这里不太理解，如果偏置是随机值，则第二层输入值不应该不等吗？</p></blockquote><p>解决方法是：若激活函数为线性函数（左右对称且中央附近可视为线性函数，如sigmoid和tanh），使用标准差为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mroot><mfrac><mn>1</mn><mi>n</mi></mfrac><mrow></mrow></mroot></mrow><annotation encoding="application/x-tex">\sqrt[]{\frac{1}{n} }</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.84em;vertical-align:-0.6049em;"></span><span class="mord sqrt"><span class="root"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.3781em;"><span style="top:-2.3781em;"><span class="pstrut" style="height:2em;"></span><span class="sizing reset-size6 size1 mtight"><span class="mord mtight"></span></span></span></span></span></span></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.2351em;"><span class="svg-align" style="top:-3.8em;"><span class="pstrut" style="height:3.8em;"></span><span class="mord" style="padding-left:1em;"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-3.1951em;"><span class="pstrut" style="height:3.8em;"></span><span class="hide-tail" style="min-width:1.02em;height:1.88em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='1.88em' viewBox='0 0 400000 1944' preserveAspectRatio='xMinYMin slice'><path d='M983 90l0 -0c4,-6.7,10,-10,18,-10 H400000v40H1013.1s-83.4,268,-264.1,840c-180.7,572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7s-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744c-10,12,-21,25,-33,39s-32,39,-32,39c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30c26.7,-32.7,52,-63,76,-91s52,-60,52,-60s208,722,208,722c56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,-658.5c53.7,-170.3,84.5,-266.8,92.5,-289.5zM1001 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.6049em;"><span></span></span></span></span></span></span></span></span> 的高斯分布初始化；对于ReLU函数，使用标准差为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mroot><mfrac><mn>2</mn><mi>n</mi></mfrac><mrow></mrow></mroot></mrow><annotation encoding="application/x-tex">\sqrt[]{\frac{2}{n} }</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.84em;vertical-align:-0.6049em;"></span><span class="mord sqrt"><span class="root"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.3781em;"><span style="top:-2.3781em;"><span class="pstrut" style="height:2em;"></span><span class="sizing reset-size6 size1 mtight"><span class="mord mtight"></span></span></span></span></span></span></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.2351em;"><span class="svg-align" style="top:-3.8em;"><span class="pstrut" style="height:3.8em;"></span><span class="mord" style="padding-left:1em;"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-3.1951em;"><span class="pstrut" style="height:3.8em;"></span><span class="hide-tail" style="min-width:1.02em;height:1.88em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='1.88em' viewBox='0 0 400000 1944' preserveAspectRatio='xMinYMin slice'><path d='M983 90l0 -0c4,-6.7,10,-10,18,-10 H400000v40H1013.1s-83.4,268,-264.1,840c-180.7,572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7s-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744c-10,12,-21,25,-33,39s-32,39,-32,39c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30c26.7,-32.7,52,-63,76,-91s52,-60,52,-60s208,722,208,722c56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,-658.5c53.7,-170.3,84.5,-266.8,92.5,-289.5zM1001 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.6049em;"><span></span></span></span></span></span></span></span></span> 的高斯分布初始化。这里n是上一层的节点数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">weight1 = np.random.randn(<span class="number">3</span>,<span class="number">4</span>) * np.sqrt(<span class="number">1.0</span>/n)</span><br><span class="line">weight2 = np.random.randn(<span class="number">3</span>,<span class="number">4</span>) * np.sqrt(<span class="number">2.0</span>/n)</span><br></pre></td></tr></table></figure><h1>batch normalization</h1><p>权重初始化的目的是使激活值分布地更好。batch normalization是一种强制性让激活值分散的方法，即以mini batch为单位，使数据进行标准差为1、均值为0的正规化分布。batch normalization也可以layer化，位于affine层和激活层之间或激活层之后。</p><p><img src="https://picgo-liubaichen.oss-cn-beijing.aliyuncs.com/batch_normalization.png" alt=""></p><p>batch normalization的优势：</p><ol><li>提高学习速度</li><li>降低对权重初始值的依赖性</li><li>抑制过拟合（下节）</li></ol><h1>过拟合与正则化</h1><p>过拟合指模型只能拟合训练数据，而对其他的如测试数据拟合较差。深度学习追求的是泛化能力，因此抑制过拟合很重要。过拟合出现的原因有：</p><ol><li>参数多，表现能力强</li><li>训练数据少</li></ol><h2 id="权值衰减">权值衰减</h2><p>过拟合往往是因为权值过大导致的，权值衰减将损失函数加上 $ \frac{1}{2}\lambda W^2 $ （平方范数或L2范数），这样在反向传播时梯度会加上 $ \lambda W $ 。权值越大，减小的速度越快。 $ \lambda$ 为超参数权值衰减系数，权重矩阵的平方是所有元素的平方和，即：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>W</mi><mo>=</mo><msqrt><mrow><msubsup><mi>w</mi><mn>11</mn><mn>2</mn></msubsup><mo>+</mo><msubsup><mi>w</mi><mn>12</mn><mn>2</mn></msubsup><mo>+</mo><mo>…</mo></mrow></msqrt></mrow><annotation encoding="application/x-tex">W=\sqrt{w_{11}^2+w_{12}^2+\dots} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.84em;vertical-align:-0.5413em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.2987em;"><span class="svg-align" style="top:-3.8em;"><span class="pstrut" style="height:3.8em;"></span><span class="mord" style="padding-left:1em;"><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7959em;"><span style="top:-2.4337em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span><span style="top:-3.0448em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2663em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7959em;"><span style="top:-2.4337em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">12</span></span></span></span><span style="top:-3.0448em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2663em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="minner">…</span></span></span><span style="top:-3.2587em;"><span class="pstrut" style="height:3.8em;"></span><span class="hide-tail" style="min-width:1.02em;height:1.88em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='1.88em' viewBox='0 0 400000 1944' preserveAspectRatio='xMinYMin slice'><path d='M983 90l0 -0c4,-6.7,10,-10,18,-10 H400000v40H1013.1s-83.4,268,-264.1,840c-180.7,572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7s-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744c-10,12,-21,25,-33,39s-32,39,-32,39c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30c26.7,-32.7,52,-63,76,-91s52,-60,52,-60s208,722,208,722c56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,-658.5c53.7,-170.3,84.5,-266.8,92.5,-289.5zM1001 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.5413em;"><span></span></span></span></span></span></span></span></span></span></p><p>权值衰减不能对付复杂的NN模型，需要使用下面的dropout</p><h2 id="dropout">dropout</h2><center><img src="https://picgo-liubaichen.oss-cn-beijing.aliyuncs.com/gif_test.gif" width = "" height = ""></center><p>dropout是一种随机删除神经元的方法，用来模拟多个神经网络的平均模型</p><h2 id="超参数优化">超参数优化</h2><p>神经网络的数据一般划分为training data、validation data和test data，其中验证数据validation data用于评估超参数的性能。经验性的方法是在超参数的某个范围内随机采样，根据accuracy评估。</p><h1>卷积神经网络</h1><p>卷积神经网络convolutional neural network，相对于之前的全连接网络只能输入一维数组，CNN能够直接反应多维数组的空间特征。CNN新增加了卷积层convolution layer和pooling layer，组成了卷积层-激活层-（池化层）的基本结构，取代了affine层-激活层。卷积层的输入和输出数据又可以称为input feature map和output feature map。很多神经网络在输出层前会会放置一个全连接层。</p><blockquote><p>全连接网络形容相邻层的所有神经元之间都有连接</p></blockquote><h2 id="卷积层">卷积层</h2><p>下次复习时再整吧</p><h2 id="池化层">池化层</h2><p>池化层通过将矩阵的每一个区域当成一个元素处理，<strong>缩小空间大小</strong>。如下图所示，处理区域为(2,2)，一般池化层的步幅为处理区域的窗口大小，这里为2。通过将处理区域的最大值元素提取出来组成新的元素，这样的处理称为max池化，适用于图像处理。此外还有average池化等。池化层没有学习参数，并且处理前后通道数不变。</p><p><img src="https://picgo-liubaichen.oss-cn-beijing.aliyuncs.com/pooling_layer.png" alt=""></p><blockquote><p>Sergey Ioffe and Christian Szegedy（2015）: Batch Normalization: Accelerating Deep Network Training by Reducing Internal Covariate Shift. arXiv:1502.03167 [cs] (February 2015).</p></blockquote><h2 id="卷积层和池化层的实现">卷积层和池化层的实现</h2><p>img2col函数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">a = np.arange(<span class="number">32</span>).reshape(<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">4</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">im2col</span>(<span class="params">input_data, filter_h, filter_w, stride=<span class="number">1</span>, pad=<span class="number">0</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Parameters</span></span><br><span class="line"><span class="string">    ----------</span></span><br><span class="line"><span class="string">    input_data : 由(数据量, 通道, 高, 长)的4维数组构成的输入数据</span></span><br><span class="line"><span class="string">    filter_h : 滤波器的高</span></span><br><span class="line"><span class="string">    filter_w : 滤波器的长</span></span><br><span class="line"><span class="string">    stride : 步幅</span></span><br><span class="line"><span class="string">    pad : 填充</span></span><br><span class="line"><span class="string">    -------</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    N, C, H, W = input_data.shape</span><br><span class="line">    out_h = (H + <span class="number">2</span>*pad - filter_h)//stride + <span class="number">1</span></span><br><span class="line">    out_w = (W + <span class="number">2</span>*pad - filter_w)//stride + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    img = np.pad(input_data, [(<span class="number">0</span>,<span class="number">0</span>), (<span class="number">0</span>,<span class="number">0</span>), (pad, pad), (pad, pad)], <span class="string">&#x27;constant&#x27;</span>)</span><br><span class="line">    col = np.zeros((N, C, filter_h, filter_w, out_h, out_w))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(filter_h):</span><br><span class="line">        y_max = y + stride*out_h</span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(filter_w):</span><br><span class="line">            x_max = x + stride*out_w</span><br><span class="line">            col[:, :, y, x, :, :] = img[:, :, y:y_max:stride, x:x_max:stride]</span><br><span class="line"></span><br><span class="line">    col = col.transpose(<span class="number">0</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>).reshape(N*out_h*out_w, -<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> col</span><br><span class="line"></span><br><span class="line">b = im2col(a,<span class="number">3</span>,<span class="number">3</span>)</span><br><span class="line">b.ndim</span><br><span class="line">b.shape</span><br></pre></td></tr></table></figure><p>输入信号经过img2col处理后，转变为(N*out_h*out_w,通道数C*filter_h*filter_w)的矩阵。整个过程相当于将滤波器处理的顺序矩阵区域按行排列（下图）：左侧的矩阵为一个图片矩阵，每一个小三维矩阵代表滤波器要处理的区域，将其按照通道顺序排列，组成二维矩阵（右侧）</p><p><img src="https://picgo-liubaichen.oss-cn-beijing.aliyuncs.com/input_convolution_process.png" alt=""></p><blockquote><p>《深度学习入门——基于python的理论与实现》</p></blockquote><p>滤波器的处理与输入信号类似，将每一个滤波器矩阵根据通道数按列排放（这一点与输入信号不同，思考一下矩阵的乘法规律）<br><img src="https://picgo-liubaichen.oss-cn-beijing.aliyuncs.com/convolution_layer.png" alt=""></p><blockquote><p>《深度学习入门——基于python的理论与实现》</p></blockquote><p><img src="https://picgo-liubaichen.oss-cn-beijing.aliyuncs.com/convolution_work.webp" alt=""></p><blockquote><p>能看懂就是胜利(bushi)</p></blockquote><p>池化层比卷积层简单不少，直接将处理区域按行排列即可；求取每一行的最大值，然后再reshape</p><p><img src="https://picgo-liubaichen.oss-cn-beijing.aliyuncs.com/pooling_process.png" alt=""></p><h2 id="卷积神经网络在干什么">卷积神经网络在干什么</h2><p>之前大三一门关于机器学习的课上第一次接触神经网络，当时稀里糊涂地用matlab搞了一下，一直好奇卷积神经网络究竟在干什么。这本书里终于给了我一点定性的认识。每一个卷积层都能识别出图像的特征，例如第一层响应边缘，第五层响应物体，最后一层（affine层）响应物体类别。</p>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 深度学习 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在市场经济和计划经济的十字路口——新经济政策研究（1921-1929）</title>
      <link href="/posts/11347/"/>
      <url>/posts/11347/</url>
      
        <content type="html"><![CDATA[<p>本篇文献来自《一个大国的崛起与崩溃——苏联历史专题研究（1917-1991）》，作者为郑异凡</p><h1>产生</h1><p>十月革命后不久推行的余粮收集制并不是纯粹出于战争目的，而是早已成为列宁头脑中实现无产阶级专政和社会主义的最有力手段。大面积饥荒、对余粮收集制的不满、征粮队的粗暴不法行为，农民暴动开始了。其中规模最大的坦波夫起义（安东诺夫暴乱）最令苏维埃政府震撼，它的口号包括：打倒粮食征收制、自由贸易万岁、在斗争中夺回自己的权利、劳动农民联盟万岁。农民起义是促使布尔什维克政党改变政策的根本原因，而喀琅施塔得事件是推动改革的最后一击。事实上，党内对于余粮收集制存在的严重问题一直都有质疑。1920年初托洛茨基在西伯利亚考察后提出替代现有政策的方案，但是遭到政治局多数派的反对。1920年夏已经有部分省份执行事实上的“新经济政策”，而在这些地区苏维埃的风评明显较好。直到这时，列宁仍然坚持“要使每个农民家庭，连一普特余粮都不剩” 。</p><p>到1921年初，形势急转直下，列宁被迫同意用粮食税代替余粮收集制。十大上，布尔什维克高层关于粮食税和自由贸易两大问题存在巨大分歧。不过列宁的想法已经发生了大逆转，新经济政策在列宁的推动下诞生了。3月21日，实物税代替余粮收集制的法令正式通过。次年又改征统一的农业货币税，确保农民保有较高的积极性。商业方面，新经济政策最显著的特征是用“商品买卖”取代“产品交换”，前者曾被列宁视为反革命的资本主义口号。</p><p>新经济政策可概括为下列一些列措施：</p><ol><li>粮食税取代余粮收集制</li><li>允许农产品自由买卖，承认市场机制</li><li>在国家保持经济命脉的情况下实行中小工业的非国有化</li><li>把大工业企业联合成托拉斯和辛迪加，实行经济核算</li><li>取消劳动义务制和劳动动员，按照产品的质量和数量支付劳动报酬</li><li>一定程度上允许私人资本在工业、农业、商业、服务行业中的自由发展，鼓励合作社、农村雇工和租地合法化</li><li>允许外国资本进入，实行租让制和租赁制，重建银行和税收制度</li><li>实行货币改革，取消苏维埃货币，发行稳定的货币切尔文卢布</li></ol><p>可是实行新经济政策不代表真正建立的市场关系。党对经济工作的全面绝对领导缺乏政治体制的保障，使得经济核算、自负盈亏等商业原则实行的可能性为0。</p><h1>两次危机</h1><p>1923年夏秋，由于工业企业过分追求利润，猛烈提高工业品价格，导致工农业剪刀差大幅提高。这导致农民承受不起高昂的工业品价格，工人的工资也被拖欠，引发新一波罢工和农民起义浪潮。第一次危机最终是靠行政指令（而非市场调节）得到解决。1928年初又爆发第二次危机，起因是谷物价格连年下降，而经济作物和畜产品价格不断上涨，农业内部剪刀差加大。这导致农民更倾向于把粮食留下来饲养牲畜，或者种植经济作物。针对这次危机，中央政府仍然无视市场关系，而采取了更加“有效”、直接的方式——利用行政指令对付不出售粮食的农民。斯大林在此基础上提出了 <strong>“贡税论”</strong>，要求农民自行低价出售农产品，并提高工业品价格，将工农业剪刀差合法化，并且动用国家机器镇压不服从的农民。这之后不久斯大林就强制实施了全盘集体化。</p><h1>争论</h1><p>新经济政策的提出者列宁面临着党内大多数人的质疑和反对，坚持民主集中制的他不得不在一定程度上做出让步。反对者将新经济政策视为对农民的让步与妥协，是不可避免的“恶”。因此当农民暴动因为农村改革和武装镇压而平息后，新经济政策的合理性成为焦点，质疑的声音越来越大。1922年列宁病重后，“三驾马车”季诺维也夫、加米涅夫和斯大林开始打击粮食自由贸易。列宁被迫在党的十一大上宣布停止“退却”，转入“进攻”。</p><p>斯大林的观点很能说明为什么新经济政策为什么失败。他将其称之为了实际问题，而非理论问题，因此不屑于花费时间与资产阶级妥协。言下之意为，理论上的错误，就不可能有实行中的正确。这就是大多数死脑筋的共产主义者的观点。列宁最早亦否认市场的调节作用，但是在《论合作社》中，列宁把合作社直接等同于社会主义，而其他左派领导人认为合作社仍属于国家资本主义。党内高层中支持新经济政策的，仅有李可夫和布哈林，即后来的布哈林-李可夫反党集团。托洛茨基派、季诺维耶夫派、斯大林派担心农村分化，都打“反富农”的牌。打压富农和私商的政策得到了怀有平均主义心态的群众的拥护，以有钱、有生产资料为反革命分子的判定标准，劫富济贫的风气蔓延开来。以穷为荣，布尔什维克的许多干部把穷人当作唯一的依靠对象，挑动农民斗农民，动辄发动穷人斗富人，用群众内部矛盾转移党群矛盾。</p><p>左派领导人都是急性子，迷信于行政手段“立竿见影”的效果，在战略上鄙视市场手段，战术上嫌弃市场调节。1926年上任的商业人民委员米高扬宣称：“农民自发势力、农民谷物市场完全为我们所控制，我们随时可以降低或提高粮食价格···因为我们掌握了全部发挥作用的杠杆···因为没有人替庄稼汉说话，没有人妨碍我们！”。</p><p>为什么会这样呢？</p>]]></content>
      
      
      <categories>
          
          <category> 历史 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 苏联史 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>1924——1927年的党内斗争</title>
      <link href="/posts/12309/"/>
      <url>/posts/12309/</url>
      
        <content type="html"><![CDATA[<p>本篇为《苏联兴亡史》的读书笔记，时间为2022年11月13日</p><h1>第一反对派——托洛茨基派</h1><p>列宁逝世后不久，4月份托洛茨基发表《论列宁》一书，又在9月发表《十月的教训》。后者刻意强调十月革命前夕季诺维耶夫和加米涅夫因为反对武装起义，故意将起义讯息在报纸上透漏出去，意图打倒斯大林的两个“搭档”。这成了党内第二次斗争的导火索。然而托洛茨基一方本就处于劣势，再加上托洛茨基与列宁在革命前的来往信件 被公布，斗争完全演变为单方面的大批判。</p><blockquote><p>1913年前后托洛茨基和列宁就布尔什维克和孟什维克有巨大分歧，事实上直至十月革命前期托洛茨基才正式加入布尔什维克</p></blockquote><h1>新反对派——季诺维耶夫和加米涅夫派</h1><p>1925年初托洛茨基被解除所有关键职务后，党内第三次斗争接踵而至。斯大林的原“搭档”季诺维耶夫和加米涅夫结成新的反对派，同斯大林的中央多数派对峙。双方对峙的焦点是是否仍继续坚持新经济政策。季诺维耶夫坚持消灭阶级和世界革命的“左倾”路线，这让他与托洛茨基结成联盟。不可思议的是，列宁遗孀克鲁普斯卡娅也是新反对派的重要成员。党内斗争还与“一国社会主义”、新经济政策和农村政策的争论掺和在一起。不过依我看，这些争论完全就是“理论之上”、漠视现实的空想思维。一群完全不体察民情的权力家去用最枯燥无聊的东西决定关乎亿万人生活与生存，这本身就是荒谬的。至于所谓的富农问题，从实际上讲，本就占据少数地位的富农难道比官僚主义危害更大？</p><p>1925年底召开的第十四次代表大会在莫斯科召开，中央派和新反对派展开激烈斗争。结果是季诺维耶夫和加米涅夫为首的新反对派失败，并失去了在列宁格勒的势力。</p><blockquote><p>原本计划在列宁格勒召开。由于列宁格勒是新反对派的大本营，又临时改在莫斯科召开</p></blockquote><h1>托李联盟</h1><p>值得一提的是，托洛茨基在十四大上对两派的斗争采取旁观的态度。不过由于新老反对派在对待农民和新经济政策的态度上极为相似，因此在1926年4月的联共（布）中央全会上不约而同地组成了托李联盟。1926年中旬的拉舍维奇事件成为反对派联盟与中央派公开斗争的导火索。当年7月中央联席会议上反对派提出《十三人声明》，标志着托李联盟正式形成。1927年世界范围内爆发一系列反共运动，使反对派的进攻更进一步。在7月进入一段时期的低谷后，随着十五大即将召开，9月开始两派斗争逐渐走上巅峰。</p><blockquote><p>拉舍维奇事件：新反对派和拉舍维奇在内的部分委员（不包括托洛茨基？）的秘密集会被中央发现，导致拉舍维奇被剥夺一切职务，季诺维耶夫也被解除共产国际的领导职务</p></blockquote><p>10月底托洛茨基和季诺维耶夫被开除出中央委员会，反对派的各项政策、相关公开争论和会议记录甚至被刊登在《真理报》和党内杂志上，这使得中央派在中央以外取得关键性的多数支持。1927年底的十五大正式将托李联盟的75名骨干开除出党，反对派正式宣告失败。</p>]]></content>
      
      
      <categories>
          
          <category> 历史 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 苏联史 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>农业集体化运动</title>
      <link href="/posts/43865/"/>
      <url>/posts/43865/</url>
      
        <content type="html"><![CDATA[<h1>苏联农业集体化运动(1929-1934)</h1><p>本篇为《苏联兴亡史》第十一章的读书笔记，记录时间为2022年11月22日</p><p>宏观上极其美好，微观上脱离实际</p><h2 id="第一次集体化运动（1929-1930）">第一次集体化运动（1929-1930）</h2><p>1929年4月“右倾机会主义”斗争后，集体农庄化速度大大加快。他们通过政治宣传、设立指标、设定deadline等方式逼迫农民加入集体农庄。各地都想更早地跨进社会主义。共产党员采取的措施，包括不加入就剥夺土地和选举权、不在场即视为同意、不加入即被视为苏维埃的敌人、暴力威胁等耳熟能详的手段。但1929年-1930年初的农业集体化运动竟然是被斯大林叫停的。1930年3月2日斯大林在被大量的投诉信淹没后，终于在《真理报》上刊登《胜利冲昏头脑》一文，给集体化运动降温。农民不了解全国集体化运动是怎样组织和高涨起来的，甚至把斯大林当作支持他们反对地方上过火行为的旗手。 一切地方干部也确实收到了处罚，甚至法律制裁。</p><p>4月3日斯大林又发文《答集体农庄庄园同志们》，把责任推给地方干部。这导致1930年十六次党代会上许多干部尖锐批判斯大林不能诚实地评价出现错误的原因。工人马马耶夫在6月9日的《真理报》上刊登《给党的十六次代表大会的信》，要求斯大林有勇气讲出自己的毛病，而不要以此来教训基层党员和群众。当然这些人都无一例外地受到严厉处罚。第一次农业集体化运动事实上是以失败告终的。到1930年7月1日，集体农庄农户降至23.6%，相较于巅峰时期的56%已经降低半数以上。</p><h2 id="消灭富农运动">消灭富农运动</h2><p>1929年12月27日，斯大林在《论苏联土地政策的几个问题》演说中，明确表明，富农是农业集体化运动的死敌，绝不能让富农加入集体农庄。这标志着苏联从限制和排挤富农阶级政策到消灭富农阶级政策的急剧转变。1930年2月4日即将富农划分为第一、二、三类三个等级，分别有7.7万、16.5万、80万户。 第一类为反革命富农，将被送入劳改营或处以极刑，家属被驱逐至边远地区；第二类为反集体化富农，全家被驱逐至边远地区 ；其余的为第三类，被迁至专门地区。然而实际上受到牵连的数目远高于以上数值。</p><blockquote><p>关于第二类和第一类亲属的流放相关历史，参考本站《大迁移——苏联的特殊移民政策及其后果》</p></blockquote><h2 id="评论：这一切到底是为什么？">评论：这一切到底是为什么？</h2><p>略…</p><p>罗莎卢森堡：没有普选，没有不受限制的出版和集会自由，没有自由的意见交锋，任何公共机构的生命就要逐渐灭绝，就成为没有灵魂的生活，只有官僚仍是其中唯一的活动因素。</p><h2 id="第二次农业集体化运动">第二次农业集体化运动</h2><p>到1930年秋，集体农庄运动又掀起新高潮。截至1933年，全国已经建立起224500个集体农庄，农户1520万户，占65%。1935年2月正式规定集体农庄的耕地全部归集体农庄永久使用。到1937年底，全国共243700个集体农庄，1850万户，占93%。1927-1928年间，国家实行非常措施收购粮食，一年的商品粮也只有5亿普特左右。实现集体化后，实行农副产品义务交售制，1933年国家得到11.3亿普特商品粮。全国的粮食总产量没有增加，而商品粮却成倍增加，这背后的原因可想而知。斯大林大幅度出口商品粮，以换取购买工业设备所需要的外汇，是造成大饥荒的直接原因。这种惨无人道的原始积累方式固然完成了工业化，却是打着善意的幌子，建立在本国人民血肉之上的罪恶之证，在残酷程度上资本主义原始积累都决不能与之相提并论。</p>]]></content>
      
      
      <categories>
          
          <category> 历史 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 苏联史 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>深度学习(1)——perceptron</title>
      <link href="/posts/24073/"/>
      <url>/posts/24073/</url>
      
        <content type="html"><![CDATA[<h1>numpy基础</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy </span><br><span class="line"></span><br><span class="line"><span class="comment">#? 构建矩阵</span></span><br><span class="line">a = numpy.array([[<span class="number">1</span>,<span class="number">2</span>],[<span class="number">2</span>,<span class="number">4</span>]])</span><br><span class="line">b = numpy.array([<span class="number">10</span>,<span class="number">20</span>,<span class="number">30</span>,<span class="number">40</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">#? 遍历矩阵</span></span><br><span class="line">c = numpy.array([[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],[<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>]])</span><br><span class="line">size = c.shape</span><br><span class="line"><span class="built_in">print</span>(size[<span class="number">0</span>])</span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> <span class="built_in">range</span>(size[<span class="number">0</span>]):</span><br><span class="line">    <span class="keyword">for</span> col <span class="keyword">in</span> <span class="built_in">range</span>(size[<span class="number">1</span>]):</span><br><span class="line">        <span class="built_in">print</span>(c[row][col])</span><br><span class="line">        </span><br><span class="line"><span class="comment">#? 数据类型转换</span></span><br><span class="line">a = numpy.array([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line"><span class="built_in">print</span>(a.astype(numpy.float32))</span><br></pre></td></tr></table></figure><h1>感知机</h1><pre><code class="language-python">#! 矩阵表示感知机import numpy#! AND gatedef AND(x1,x2):    x = numpy.array([x1,x2])    w = numpy.array([0.5,0.5])    b = -0.8    res = numpy.sum(x*w)+b    if res&lt;=0:        return 0    else:        return 1    def NAND(x1,x2):    x = numpy.array([x1,x2])    w = numpy.array([0.5,0.5])    b = -0.8    res = numpy.sum(x*w)+b    if res&lt;=0:        return 1    else:        return 0def OR(x1,x2):    x = numpy.array([x1,x2])    w = numpy.array([0.5,0.5])    b = -0.4    res = numpy.sum(x*w)+b    if res&lt;=0:        return 0    else:        return 1    #! 使用多层感知机构建异或门def XOR(x1,x2):    #? first layer    s1 = NAND(x1,x2)    s2 = OR(x1,x2)    res = AND(s1,s2)    if res&lt;=0:        return 0    else:        return 1XOR(1,1)</code></pre>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 深度学习 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>python实现批量修改文件名称</title>
      <link href="/posts/45714/"/>
      <url>/posts/45714/</url>
      
        <content type="html"><![CDATA[<p>需要修改的有两个地方：文件夹路径和目标名称的格式（基于正则表达式）</p><blockquote><p>文件夹下的子文件夹不影响运行，且不会被更改名称</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rename file, according to format and regular expression</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">logging.basicConfig(level=logging.INFO,<span class="built_in">format</span>=<span class="string">&#x27;%(asctime)s - %(levelname)s: %(message)s&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">     path = <span class="string">&#x27;D:/test/&#x27;</span></span><br><span class="line">     <span class="comment">#? insert file directory path</span></span><br><span class="line">     regex = re.<span class="built_in">compile</span>(<span class="string">r&#x27;.*?\.(.*)&#x27;</span>)</span><br><span class="line">     <span class="keyword">try</span>:</span><br><span class="line">          filelist = os.listdir(path)</span><br><span class="line">          <span class="built_in">print</span>(filelist)</span><br><span class="line">          n=<span class="number">0</span></span><br><span class="line">          <span class="keyword">for</span> i <span class="keyword">in</span> filelist:</span><br><span class="line">               path_old = path + i</span><br><span class="line">               file_format = re.search(regex,path_old)</span><br><span class="line">               <span class="keyword">if</span> file_format:</span><br><span class="line">                    path_new = path + <span class="string">f&#x27;file<span class="subst">&#123;n&#125;</span>.<span class="subst">&#123;file_format.group(<span class="number">1</span>)&#125;</span>&#x27;</span>   <span class="comment">#type:ignore</span></span><br><span class="line">                    <span class="comment">#? imput new name and format</span></span><br><span class="line"></span><br><span class="line">                    os.rename(path_old,path_new)</span><br><span class="line"></span><br><span class="line">                    logging.info(<span class="string">&#x27;rename %d file&#x27;</span>,n)</span><br><span class="line">                    n+=<span class="number">1</span></span><br><span class="line">               <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">pass</span></span><br><span class="line">     <span class="keyword">except</span>:</span><br><span class="line">          <span class="built_in">print</span>(<span class="string">&quot;file not found&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">     main()</span><br></pre></td></tr></table></figure><p>3月29日修正：部分文件夹（如ondrive）可能因为权限原因无法修改文件名称</p>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 杂谈 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>N3</title>
      <link href="/posts/46453/"/>
      <url>/posts/46453/</url>
      
        <content type="html"><![CDATA[<h1>unit 1</h1><p>中国旅行をしている間は毎日中国料理を食べました</p><p>新宿と秋葉原の間に駅がいくつありますか</p><p>リンゴはほとんどアメリカあたりから輸入している</p><p>いくら学者でもわからないことがたくさんある</p><p>もう春になったが北海道のほうはまだいくらか寒いようです</p><p>いったん始めた以上は最後まで頑張りなさい</p><p>経済は悪くなる一方で企業の採用の数も減っている</p><p>中級の勉強が始まってから授業が分からなくなる一方だ</p><p>その子は今にも泣きそうな顔で部屋を飛び出していった</p><p>彼にごちそうになった上にプレゼントまでもらった</p><p>人間が生きていく上で絶対必要なものは水である</p><p>よく考えた上でどうするか決めてください</p><p>気がつかないうちに木の葉が落ち始め秋がやって来た</p><p>雨が降っているうちは宿題ができない</p><p>家にばかりいないで映画でも見に行こうじゃないか</p><p>私は日本へ来てからもうすぐ五年が経とうとしている</p><p>あの悲しい事件は忘れようとしても忘れられない</p><h1>unit 2</h1><p>子供が助かったのはあなたのおかげです</p><p>その目覚ましは二十秒おきに二回鳴る</p><p>今のままでは失業者がどんどん増えるおそれがある</p><p>その人にそんなことを言った覚えはない</p><p>日本に来たばかりのころは何度か不愉快な思いをしたものだ</p><p>この花変なにおいがする</p><p>いつも静かで優しいあの人がそんなことを言ったなんてちょっと信じがたいことだ</p><p>何度も失敗をするとまた失敗をするのではないかと考えがちになる</p><p>我々の意見がしっかりしているのだが君が賛成するかどうか聞きたいんです</p><p>雨は今晩から明日の朝にかけて降り続くようです</p><p>成績からいうと・いえば・いって、田中さんはクラスのトップです</p><p>あの方は服装からして先生らしくない</p><p>田舎は空気からして違う</p><p>彼の能力からすると東京大学に十分合格できるだろう</p><p>私から見ると</p><p>兄は本当は気が弱いんです、強がっているだけです</p><p>部長の代わりに私がそのパーティーに出席した</p><p>天気が良かったのでいつものバスで行く代わりに歩いて行った</p><p>林さんに剣道を教えてもらう代わりに彼に中国語を教えてあげます</p><h1>unit3</h1><p>桜が見ると春が来たという感じがしますね</p><p>部屋にだれかがいる気がする</p><p>今日は頭がちょっと痛いのであまり仕事する気がしない</p><p>昨日から風邪気味で頭が痛い</p><p>ノルウェイの森を一か月かけて読みきった</p><p>こんなたくさんのごちそうは一人で一度に食べきれません</p><p>毎日忙しいのでもう疲れきった</p><p>花子ちゃんはもう病気が治ったくせに働こうとしない</p><p>怖くて一人でトイレに行けないくらい・ぐらい・ほどだ</p><p>知らない土地を歩くくらい・ぐらい・ほど楽しいことはないと思う</p><p>大学に入ることこそ今の私の最大の目標です</p><p>心配なことに弟はまだ帰ってきません</p><p>困ったことに相手の名前はどうしても思い出せなかった</p><p>信じられないことに：令人难以置信的是</p><p>法律では二十歳未満はお酒を飲んでは行けないことになっている</p><p>会議は午後二時からということになっている</p><p>傘はまだ使えるから新しいものを買うことはない</p><p>鈴木さんはご飯を食べている最中に突然変な声を出した</p><p>Ｎ１試験の漢字の中には先生さえ・でさえ読めない漢字がある</p>]]></content>
      
      
      <categories>
          
          <category> 日语 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 日语文法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>多进程使用——以爬取豆瓣榜单为例</title>
      <link href="/posts/60146/"/>
      <url>/posts/60146/</url>
      
        <content type="html"><![CDATA[<p>今天早上学习了进程和线程，并且结合之前写的beautifulsoup文件完成了对豆瓣top250的多进程爬取。</p><blockquote><p>特别强调：使用多进程爬虫极易导致403警告（悲），慎用！</p></blockquote><h1>beautifulsoup部分</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tasks.py</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用bs4爬取douban</span></span><br><span class="line"><span class="comment"># 要点：单目标使用css选择器，多目标使用findall遍历，获取文本尽量选择get_text()，string部分情况会提取不到</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> makedirs</span><br><span class="line"><span class="keyword">from</span> os.path <span class="keyword">import</span> exists</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">logging.basicConfig(level=logging.INFO,<span class="built_in">format</span>=<span class="string">&#x27;%(asctime)s - %(levelname)s: %(message)s&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">main_url = <span class="string">&#x27;https://movie.douban.com/top250&#x27;</span></span><br><span class="line">headers =   &#123;</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>:<span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">total_page = <span class="number">10</span></span><br><span class="line">result_doc = <span class="string">&#x27;test&#x27;</span></span><br><span class="line">exists(result_doc) <span class="keyword">or</span> makedirs(result_doc)<span class="comment">#type:ignore</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_url</span>(<span class="params">page</span>):</span><br><span class="line">    url = <span class="string">f&#x27;<span class="subst">&#123;main_url&#125;</span>?start=<span class="subst">&#123;page&#125;</span>&amp;filter=&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> crawl_index(url)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">crawl_index</span>(<span class="params">url</span>):</span><br><span class="line">    cont = requests.get(url,headers=headers)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> cont.status_code == <span class="number">200</span>:</span><br><span class="line">            soup = BeautifulSoup(cont.text,<span class="string">&#x27;lxml&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> soup</span><br><span class="line">        logging.error(<span class="string">&#x27;getting wrong code %s while crawling %s&#x27;</span>,cont.status_code,url)</span><br><span class="line">    <span class="keyword">except</span> requests.RequestException:</span><br><span class="line">        logging.error(<span class="string">&#x27;error occurred while scraping %s&#x27;</span>, url, exc_info=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse_index</span>(<span class="params">soup</span>):</span><br><span class="line">    <span class="keyword">for</span> elem <span class="keyword">in</span> soup.find_all(<span class="string">&#x27;div&#x27;</span>,&#123;<span class="string">&#x27;class&#x27;</span>:<span class="string">&#x27;hd&#x27;</span>&#125;):</span><br><span class="line">        <span class="keyword">yield</span> (elem.a[<span class="string">&#x27;href&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">crawl_detail</span>(<span class="params">url</span>):</span><br><span class="line">    <span class="keyword">return</span> crawl_index(url)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse_detail</span>(<span class="params">soup</span>):</span><br><span class="line">    name = soup.find(<span class="string">&#x27;span&#x27;</span>,&#123;<span class="string">&#x27;property&#x27;</span>:<span class="string">&quot;v:itemreviewed&quot;</span>&#125;).string</span><br><span class="line">    director = soup.select(<span class="string">&#x27;#info &gt; span:nth-child(1) &gt; span.attrs &gt; a&#x27;</span>)[<span class="number">0</span>].get_text()</span><br><span class="line">    <span class="comment"># select为bs4的css选择器</span></span><br><span class="line">    actors = soup.find_all(<span class="string">&#x27;a&#x27;</span>,&#123;<span class="string">&#x27;rel&#x27;</span>:<span class="string">&quot;v:starring&quot;</span>&#125;)</span><br><span class="line">    actor = []</span><br><span class="line">    <span class="keyword">for</span> em <span class="keyword">in</span> actors:</span><br><span class="line">        actor.append(em.string)</span><br><span class="line">    categories = soup.find_all(<span class="string">&#x27;span&#x27;</span>,&#123;<span class="string">&#x27;property&#x27;</span>:<span class="string">&quot;v:genre&quot;</span>&#125;)</span><br><span class="line">    category = []</span><br><span class="line">    <span class="keyword">for</span> em <span class="keyword">in</span> categories:</span><br><span class="line">        category.append(em.string)</span><br><span class="line">    times = soup.find_all(<span class="string">&#x27;span&#x27;</span>,&#123;<span class="string">&#x27;property&#x27;</span>:<span class="string">&quot;v:initialReleaseDate&quot;</span>&#125;)</span><br><span class="line">    time = []</span><br><span class="line">    <span class="keyword">for</span> em <span class="keyword">in</span> times:</span><br><span class="line">        time.append(em.string)</span><br><span class="line">    score = soup.select(<span class="string">&#x27;#interest_sectl &gt; div.rating_wrap.clearbox &gt; div.rating_self.clearfix &gt; strong&#x27;</span>)[<span class="number">0</span>].string</span><br><span class="line">    summary = soup.select(<span class="string">&#x27;#link-report-intra &gt; span:nth-child(1)&#x27;</span>)[<span class="number">0</span>].get_text().strip().replace(<span class="string">u&#x27;\u3000&#x27;</span>, <span class="string">u&#x27; &#x27;</span>).replace(<span class="string">u&#x27;\xa0&#x27;</span>, <span class="string">u&#x27; &#x27;</span>).replace(<span class="string">&#x27;\n&#x27;</span>,<span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27;\r&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="string">&#x27;name&#x27;</span>:name,</span><br><span class="line">        <span class="string">&#x27;director&#x27;</span>:director,</span><br><span class="line">        <span class="string">&#x27;actor&#x27;</span>:actor,</span><br><span class="line">        <span class="string">&#x27;category&#x27;</span>:category,</span><br><span class="line">        <span class="string">&#x27;time&#x27;</span>:time,</span><br><span class="line">        <span class="string">&#x27;score&#x27;</span>:score,</span><br><span class="line">        <span class="string">&#x27;summary&#x27;</span>:summary</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">save</span>(<span class="params">data</span>):</span><br><span class="line">    name = data.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">    data_path = <span class="string">f&#x27;<span class="subst">&#123;result_doc&#125;</span>/<span class="subst">&#123;name&#125;</span>.json&#x27;</span></span><br><span class="line">    json.dump(data,<span class="built_in">open</span>(data_path,<span class="string">&#x27;w&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>),ensure_ascii=<span class="literal">False</span>,indent = <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main_task</span>(<span class="params">page</span>):</span><br><span class="line">    index_html = get_url(<span class="number">25</span>*page)</span><br><span class="line">    detail_urls = parse_index(index_html)</span><br><span class="line">    <span class="keyword">for</span> detail_url <span class="keyword">in</span> detail_urls:</span><br><span class="line">        detail_html = crawl_detail(detail_url)</span><br><span class="line">        data = parse_detail(detail_html)</span><br><span class="line">        logging.info(<span class="string">&#x27;get detail data %s&#x27;</span>,data)</span><br><span class="line">        logging.info(<span class="string">&#x27;saving data&#x27;</span>)</span><br><span class="line">        save(data)</span><br><span class="line">        logging.info(<span class="string">&#x27;save data successfully&#x27;</span>)</span><br></pre></td></tr></table></figure><h1>multiprocess部分</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># main.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"><span class="keyword">from</span> tasks <span class="keyword">import</span> main_task</span><br><span class="line"></span><br><span class="line">TOTAL_PAGE = <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    pool = Pool(<span class="number">8</span>)</span><br><span class="line">    pages = <span class="built_in">range</span>(<span class="number">1</span>, TOTAL_PAGE + <span class="number">1</span>)</span><br><span class="line">    pool.<span class="built_in">map</span>(main_task, pages)</span><br><span class="line">    pool.close()</span><br><span class="line">    pool.join()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> scraping </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AI绘画</title>
      <link href="/posts/28475/"/>
      <url>/posts/28475/</url>
      
        <content type="html"><![CDATA[<h1>2023.3.23</h1><p>今天按照b站up主秋大的贴心教程搞定了webui和lora的安装，并且成功在google的colab上训练了後藤ひとり的lora模型（因为显存可能不太够，还没在本地训练）</p><p>晚上在本地用中午训练的模型试了一下文生图，竟然有一张还 <s>不错</s> 的!</p><h1>2023.3.27</h1><p>前天在c站看到Cheese Daddy’s Landscapes mix大模型，一眼就喜欢上了，今天花了一个小时就拿到了一张不错的图</p><h1>2023.4.5</h1><p>这几天又陆续对3月27日的图进行了修改，并且尝试了纯风景图</p><p><img src="https://picgo-liubaichen.oss-cn-beijing.aliyuncs.com/fujiyama-shaonv.webp" alt=""></p><p>这张图我真的超级喜欢，就是背景的三个山头真的碍眼···想用inpaint修改一下结果发现容易出黑边，可能需要用ps修正，或者再学一学inpaint的技巧</p><p>这几天的使用让我对AI的迅速发展大受震惊，感觉自己之前就是一个原始人···总之非常感谢深度学习的研发者、模型分享者以及谷歌无偿的colab，让我这个没有任何艺术细胞的人能够体验到绘画的乐趣。</p>]]></content>
      
      
      <categories>
          
          <category> diary </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 杂谈 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>悲剧是这样诞生的——“卡廷事件”与战前苏波关系</title>
      <link href="/posts/47336/"/>
      <url>/posts/47336/</url>
      
        <content type="html"><![CDATA[<p>本篇文献来自《一个大国的崛起与崩溃——苏联历史专题研究（1917-1991）》，作者为中国社科院俄罗斯东欧中亚研究所研究员吴伟。非常巧的是，我和吴老师都是来自河南最东部的小县城。</p><h1>1939苏联入侵波兰</h1><p>关于1939年的苏波战争的前因，本文并没有涉及，但我觉得还是有必要了解的。</p><blockquote><p>苏波战争一般指发生在1919-1921年的战争，以苏俄惨败告终。这次战争也可视为1939年战争的诱因</p></blockquote><p>从1938年起，德国的扩张野心开始付诸行动。3月，德国吞并奥地利；5月，捷克斯洛伐克五月危机，德国占领苏台德地区；10月慕尼黑会议，英法对德国采取绥靖政策。针对德国的行动，苏联从1933年起就希望与英法联合，共同对抗德国。但是一系列条约都由于种种原因未能发挥作用（如东方公约、法苏互助条约）。1939年初，苏联在与英法协商迟迟未果的情况下私下与德国谈判，并在8月23日苏德成功缔结互不侵犯条约。</p><p>1939年9月1日，德军进攻波兰，第二次世界大战爆发。根据互不侵犯条约的内容，苏联声称波兰国家不复存在，于9月17日出兵占领西乌克兰和西白俄罗斯地区，并与德国进行土地划分。</p><h1>苏联对待俘虏的态度</h1><p>苏联军队势如破竹，仅用十天就占领了既定目标，如何处理25万战俘成为一个棘手的问题。10月1日左右斯大林的决定是，释放乌克兰族和白俄罗斯族的战俘；德占区战俘被交给德国；剩余25000名普通士兵被留下当苦力；军官、警察、间谍等人员（<strong>“优待战俘”</strong>）被单独安置在几个战俘营。这种划分显然带有阶级差异，表明苏联出兵波兰的目的就是为了彻底粉碎波兰的“上层”统治阶级。在苏联领导人的眼中，统治阶级自然而然地反对苏维埃统治，因此绝无可能放他们回去。作者特别强调，这种“偏见”源于政治制度，而不以人的意志为转移。</p><h1>瓜分波兰</h1><p>10月4日，苏德签订《苏德友好及边界条约》和三个秘密协定议定书，彻底瓜分波兰。苏联为了美化侵略采取了一系列措施，包括:</p><ul><li>在条约中明确划定的界限是最后的边界并排除他国的干涉，即第三国提起异议反倒是对苏德两国利益的侵犯（美国直呼内行）</li><li>迅速在占领区建立党组织，并命令他们提出加入苏维埃的请求（2022年的乌克兰笑而不语）<br>苏联打着乌克兰族和白俄罗斯族要求统一的旗号，旗帜鲜明搞侵略；把国际问题转化为内政问题，并且光明利落的宣称自己拥有单方面的解释权。</li></ul><p>苏联用四个月的时间完成了波兰的苏维埃化，其手段不必多言。</p><h1>苏芬战争，一个“小小的”转折</h1><p>1939年11月30日，苏联发动苏芬战争（冬季战争）。苏联领导人认为能够像苏波战争一样快速取得胜利，因此如何清理“优待战俘”再一次成为棘手的问题。然而苏芬战争进行的并不顺利，截止到12月底甚至只有150名芬兰战俘，并没有出现预想的战俘问题。但苏芬战争提供了一个让贝利亚注意到“优待战俘”的契机。12月31日，贝利亚下令彻底调查战俘的身份和反革命罪行；发展谍报人员。贝利亚态度的转变不无道理，这群由波兰军官、军医、神父、资产阶级组成的知识分子普遍具有高涨的爱国主义情绪，他们不满受到的不公平对待。尽管只有少数人采取实际行动（如自杀、矿工、逃跑、建立小组织），但是在苏维埃式的审查之下，小问题被无限放大为严重问题。次年2月，贝利亚开始推行一贯采用的“减负”策略。减负无外乎三种途径：释放、劳改、处决。奥斯塔什科夫战俘营负责人索普鲁年科建议释放老弱病残和家在乌克兰/白俄罗斯的预备役军官共700人，再根据阶级划分出了要继续审查的约1100人。但贝利亚并没有采纳这个建议的前半部分，而是把这些人统统关进了内务部的监狱。这一举动已经暗示了战俘的悲惨命运。</p><blockquote><p>直到1940年2月苏联惨胜芬兰也仅有1100名战俘，甚至是之前准备的最小的战俘营都可以容纳所有人。</p></blockquote><h1>草率的悲剧</h1><p>1940年2月底3月初，政治局通过了两个重要决定：将战俘家属共20000余户迁往哈萨克；对全部战俘在<strong>审查</strong>后处以极刑。5月中旬战俘管理局的统计结果是，共处决22436人（包括三座战俘营15131人和西乌克兰/白俄罗斯监狱的7305人）。另有395人为被处死，绝大多数为贝利亚早前安置的间谍。为了永远埋藏真相，枪决全部秘密进行，甚至连凶器都是德国造瓦尔德手枪。埋尸地点包括斯摩棱斯克附近的卡廷森林、哈尔科夫和加里宁的内务部别墅区附近（分别为皮亚季哈特卡和梅德诺耶）。苏联消灭战俘的原因在第一节就已经阐明：苏维埃的敌人必须消灭。更重要的是，在半年多的关押中，苏联人发现这些战俘仍未背叛祖国与信仰，他们的改造失败了（这种改造要能成功才是真见鬼了）。这种草率的屠杀并不会反映专制的强大，反而是无能和信仰丧失的表现。</p><blockquote><p>第二个决定，即贝利亚给斯大林的一封信上有斯大林、莫洛托夫、米高扬、伏罗希洛夫的亲笔签名，还有加里宁、卡冈诺维奇表示同意的字样<br>充满苏维埃色彩的审查，先射箭后画靶</p></blockquote><h2 id="秘密行动的暴露与真相大白">秘密行动的暴露与真相大白</h2><p>1943年4月13日柏林电台向世界报告了卡廷森林的惨案，使苏联的秘密行动被曝光。16日，苏联发布公告称，‘德国企图用谎言掩盖自己的罪行’，还给出了两条反击理由：1941年苏德战争爆发后建筑工地的波兰战俘落入德军手中；卡廷森林是著名的考古发掘地。这两条理由根本就是避重就轻，甚至戈培尔都嘲笑苏联太过胡扯。但正在二次世界大战的关键时期，双方形势皆不明朗，再加上德国分裂反法西斯联盟的企图众人皆知，英美只得睁一只眼闭一只眼。</p><blockquote><p>以下内容取自维基百科，非书中内容</p></blockquote><p>进入冷战后，美国国会的一个调查组认为卡廷惨案由苏联所为，但罪行责任在西方仍然充满争议。直到80年代末，有苏联学者披露斯大林下令杀害了波兰战俘。1990年戈尔巴乔夫与时任波兰总统雅鲁泽尔斯基会谈时确认了卡廷森林之外的另外两个埋尸地点。自此之后原始资料陆续公布，我们才得以知晓卡廷事件的真相。</p>]]></content>
      
      
      <categories>
          
          <category> 历史 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 苏联史 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>xpath路径和css选择器的使用</title>
      <link href="/posts/2928/"/>
      <url>/posts/2928/</url>
      
        <content type="html"><![CDATA[<h1>路径</h1><h2 id="绝对路径">绝对路径</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/html/body/p        </span><br><span class="line">html&gt;body&gt;p</span><br></pre></td></tr></table></figure><table><thead><tr><th style="text-align:center"></th><th style="text-align:center">直接子节点</th><th style="text-align:center">子孙节点</th></tr></thead><tbody><tr><td style="text-align:center">css</td><td style="text-align:center">&gt;</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">xpath</td><td style="text-align:center">/</td><td style="text-align:center">//</td></tr></tbody></table><h2 id="相对路径">相对路径</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//div//p            # 这里的//代表从当前节点往下寻找</span><br><span class="line">div p</span><br></pre></td></tr></table></figure><p>通配符*代表选择全部</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//div/*</span><br><span class="line">div&gt;*</span><br></pre></td></tr></table></figure><h1>属性</h1><h2 id="xpath">xpath</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//*[@class=&#x27;test for xpath&#x27;]    #精确匹配</span><br><span class="line">//p[@id]        #选择全部拥有id属性的元素</span><br></pre></td></tr></table></figure><blockquote><p>文本使用单双引号都可以，但是可能会和编程语言冲突，因此我一般使用双引号，而python使用单引号<br>对于选取全部元素，如果根据tag名查找，则无需加*，如果只是用属性名查找，则需要*，如</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//p[@id=&#x27;test&#x27;]</span><br><span class="line">//*[@id=&#x27;test&#x27;]</span><br></pre></td></tr></table></figure><h2 id="css">css</h2><p>d<br>常用的id和class属性有以下简写形式</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#id</span><br><span class="line">.class</span><br></pre></td></tr></table></figure><p>一般的属性写法如下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[href=&quot;https://&quot;]       </span><br><span class="line">[href^=&quot;http&quot;][class=&quot;test&quot;]        </span><br></pre></td></tr></table></figure><blockquote><p>^代表开头，$代表节尾，[]连写代表多种属性筛选</p></blockquote><p>应用实例：选择博客主页下全部文章的div</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#recent-posts .recent-post-item</span><br></pre></td></tr></table></figure><h1>次序和顺序选择</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//div/p[2]      #选择div标签中第二个p元素</span><br><span class="line">//p[last()]     #选取最后一个p元素</span><br><span class="line">//p[position()&lt;=2&gt;]</span><br><span class="line">//p[position()&lt;3&gt;]      #二者等价，选取前两个p元素</span><br></pre></td></tr></table></figure><blockquote><p>xpath编号从1开始！<br>涉及测序选择的，建议使用xpath路径，css比较复杂<br>单独使用//p[2]的含义是选取任意节点下的第2个p元素（如果存在），不推荐此用法</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//p | // div        #多选</span><br><span class="line">p , div</span><br><span class="line"></span><br><span class="line">//p[1]/..       #父节点</span><br></pre></td></tr></table></figure><h1>练习</h1><p>以本网站为例(不一定是最简单的，主要是为了练习各种功能)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 选取本博客主页下的全部最近文章div元素</span><br><span class="line">//body//div[@class=&quot;recent-post-item&quot;][1]/following-sibling::*[@class] | //body//div[@class=&quot;recent-post-item&quot;][1]      </span><br><span class="line">.recent-posts .recent-post-item     </span><br><span class="line"></span><br><span class="line"># 选取右上角菜单栏</span><br><span class="line">//div[@id=&quot;menus&quot;]//div[@class=&quot;menus_item&quot;]</span><br><span class="line">#menus .menus_item</span><br><span class="line"></span><br><span class="line"># sidebar的标签</span><br><span class="line">//div[@class=&quot;card-tag-cloud&quot;]/a</span><br><span class="line">.card-tag-cloud a</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> scraping </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>N4复习</title>
      <link href="/posts/8335/"/>
      <url>/posts/8335/</url>
      
        <content type="html"><![CDATA[<p>记录一下复习中学习到的新知识，参考网站为<a href="https://www.sigure.tw/">時雨の町</a></p><h1>第一天</h1><h2 id="について">について</h2><blockquote><p>その事件についての説明</p></blockquote><blockquote><p>彼の仕事については知りませんでした</p></blockquote><p>类比</p><ul><li>によると  ——听说</li><li>にとって  ——对于某人来说（to）</li></ul><h2 id="形容詞・形容動詞＋がる">形容詞・形容動詞＋がる</h2><blockquote><p>あかちゃんが暑がっている時のサインはわかりますか</p></blockquote><p>描述他人的感觉不直接使用形容词/形容动词，而是借助がる（动词活用，因此宾语使用を而不是が）</p><blockquote><p>彼は犬を怖がっている</p></blockquote><h3 id="使用：たがる＝たい＋がる">使用：たがる＝たい＋がる</h3><blockquote><p>彼女は海を見たがっている</p></blockquote><p>注意：疑问句和修饰句同第一人称</p><blockquote><p>彼女は行きたいといっている</p></blockquote><h3 id="がっている-＆-がる">がっている　＆　がる</h3><p>前者形容个人的状态，后者侧重客观事实描述</p><blockquote><p>人は幽霊を怖がる</p></blockquote><h1>第二天</h1><h2 id="と-＆-たら-＆-なら-＆-ば">と　＆　たら　＆　なら　＆　ば</h2><p>这这四个词之中，と和ば比较像，なら和たら比较像</p><h3 id="と">と</h3><p>使い方：普通形（だ）<br>一···就···，有时间的紧凑感；用于客观结果的描述，不以人的意志未改变；不能接主观语气/意志动词（见下一节）</p><blockquote><p>雨が降ると試合は中止してください（違い）<br>雨が降ったら試合は中止してください（正解）<br>###　ば<br>如果···就···，与と含义接近，也可用于客观描述</p></blockquote><h3 id="たら">たら</h3><p>使い方：过去形<br>区别方法：前句假定条件成立时（因此是过去形），则会有后句的结果；还有“发现”的用法；</p><blockquote><p>家に帰ったら誰もいなかった</p></blockquote><h3 id="なら">なら</h3><p>使い方：终止形<br>区分方法：说话者知道某件事，并且以这件事为假设・条件提出结论，即<strong>针对上文提出结论</strong>，译为···的话比较好</p><blockquote><p>あの店の服がやすいです　　ー－－－     安いなら買いましょう<br>此外还可以用在各种时态，比如过去时<br>昨日安かったなら今日も安いでしょう</p></blockquote><p>##　动词使役形的助词用法————を　＆　に</p><p>动词为他动词，则用</p><p>动词为自动词，一般用を，如果又是意志动词，且使役者和被使役者均为人/动物，则可以用に</p><blockquote><p>彼女は彼を感動させました<br>意志动词指人的一直可以操作的动作动词　歩く　行く，非意志动词指感情动词　驚く　困る<br>此外，如果被使役者后又出现助词，则可以用に<br>このメッセージが彼にやる気を起こさせました</p></blockquote><h2 id="动词受身形">动词受身形</h2><p>动词受身形可以表达被动（包括迷惑の受身）、可能、自发、尊敬四种含义；值得注意的有可能和尊敬两种用法</p><p>对于一类动词（五段动词），可能形包括（以読む为例）読める・読まれる，由于后者易与被动形混淆，一般用前者</p><p>对于二类动词（一段动词），可能形为られる，助词为が<br>而当表示尊敬用法时，助词为を</p><blockquote><p>新聞が読まれますか<br>新聞を読まれますか<br>这两种说法的意思完全不同，一定要注意！</p></blockquote><h2 id="ず-＆-ぬ">ず　＆　ぬ</h2><p>ず为连用否定，ぬ为连体否定（更少用）<br>具体来说，ずに相当于ないで，ず相当于なくて；前者用于连接两个动作，后者用于描述并列关系或陈述理由</p><blockquote><p>電気を消さずに寝てしまった<br>兄は合格せず弟は合格した<br>彼女に会えず苦しい</p></blockquote><p><strong>三类动词使用せず/せぬ</strong></p><p>这两种古体否定经常用在歌词中</p><blockquote><p>思わ<strong>ず</strong>目を逸らしてしまったのはどうやったって忘れられない君の言葉</p></blockquote><h1>第三天</h1><p>##　そうだ（样态助动词）</p><table class="tg"><tbody>  <tr>    <td class="tg-0pky">动词</td>    <td class="tg-0pky">肯定<br>否定</td>    <td class="tg-0pky">ます形＋そうだ<br>ます形そうに・も・にもない</td>  </tr>  <tr>    <td class="tg-c3ow">形容词</td>    <td class="tg-c3ow">肯定<br>否定</td>    <td class="tg-c3ow">ーい＋そうだ<br>く＋なさそうだ</td>  </tr>  <tr>    <td class="tg-c3ow">形容动词</td>    <td class="tg-c3ow">肯定<br>否定</td>    <td class="tg-c3ow">そうだ<br>ではなさそうだ</td>  </tr></tbody></table><p>该文法<strong>不能用于明显的、一眼就能看出来的事物</strong>，如</p><blockquote><p><s>かわいそう子供</s></p></blockquote><p><strong>注意！</strong> 只有样态中存在なさ・よさ，传闻助动词的中仍为ない・よい（普通形否定）</p><p>另类用法：名词（只能用于否定）</p><blockquote><p>彼は先生ではなさそうです</p></blockquote><h2 id="ようだ比况助动词">ようだ比况助动词</h2><ul><li>主观推测</li><li>比喻</li></ul><blockquote><p>彼は君が思っているような人ではない</p></blockquote><ul><li>举例</li></ul><blockquote><p>犬や猫のような動物が好きです</p></blockquote><h2 id="ようだ・そうだ・らしい・みたい-总结">ようだ・そうだ・らしい・みたい　总结</h2><p>そうだ包括传闻和样态两种用法，前者相对独立，而后者与ようだ・らしい・みたい较为接近</p><table class="tg"><tbody>  <tr>    <td class="tg-0pky">そうだ（样态）</td>    <td class="tg-0pky">眼前的景象</td>  </tr>  <tr>    <td class="tg-c3ow">ようだ<br>みたい（口语）</td>    <td class="tg-c3ow">自身感觉</td>  </tr>  <tr>    <td class="tg-c3ow">らしい</td>    <td class="tg-c3ow">客观信息/传闻</td>  </tr></tbody></table><blockquote><p>そうだ（传闻）和らしい接近</p></blockquote><h1>第四天</h1><h2 id="よ-う＋とする・と思う">(よ)う＋とする・と思う</h2><blockquote><p>(よ)う＋とする应用见下一节</p></blockquote><p>とする表示正要做什么的时候发生了某事，一般接と・とき・ところ<br>と思う表示计划做某事</p><h2 id="から-＆-ので">から　＆　ので</h2><p>から有主观色彩，表示自己的“独断专行”</p><blockquote><p>風邪を引いたから学校を休みました（同辈）<br>ので语气委婉，尊重他人<br>風邪を引いたので学校を休みました（长辈）</p></blockquote><h2 id="尊敬语-谦让语-N4">尊敬语 &amp; 谦让语(N4)</h2><p>尊敬語    お・ご＋ます形＋になります</p><p>謙譲語    お・ご＋ます形＋する・いたす</p><blockquote><p>社長はもうお帰りになりました<br>写真をお撮りにしましょうか<br><s>写真を撮ってあげましょうか</s><br>あげる带有赏赐的语气，不能用于长辈/生人</p></blockquote><p><s>休息一天</s></p><h1>第五天</h1><h2 id="过去形-ことにする">过去形+ことにする</h2><p>表示&quot;当作···&quot;的含义</p><blockquote><p>見なかったことにする<br>そのことは聞かなかったことにする</p></blockquote><h2 id="可能形-＆-ことができる">可能形　＆　ことができる</h2><p>可能形仅表示能力，ことができる既可表示能力，又可表示环境不允许</p><blockquote><p>日本語は話せません<br>日本語は話すことができません    （不会说日语 / 这个场合不能说日语）</p></blockquote><h2 id="ところ-使い方">ところ　使い方</h2><h3 id="よ-う＋としていたところ">(よ)う＋としていたところ</h3><p>中文释义：正要做某事的时候，强调这个动作已经开始，所以使用た形，也可以使用普通形ところ或(よ)う＋としているところ（意思比较接近，但不完全相同）</p><blockquote><p>ちょうど寝ようとしていたところ電話がかかってきた   (人已经躺在床上)<br>お出かけされるところ申し訳ありませんが少しだけ時間をください<br>这里受身形为敬语，ところ+敬语是一种打扰别人时候的常用表达</p></blockquote><h3 id="过去形ところ-过去形ばかり">过去形ところ &amp; 过去形ばかり</h3><p>中文释义：刚刚做某事</p><h1>第六天</h1><h2 id="ようにする-＆-ようになる">ようにする　＆　ようになる</h2><p>ようにする：下定决心养成某种习惯，常与できるだけ搭配，ている表示长期的习惯</p><blockquote><p>毎日一時間運動するようにしている<br>ようになる：习惯上的演变，多指由无能力到有能力<br>母親はやっとパソコンが使えるようになった</p></blockquote><h2 id="ように言う-＆-と言う">ように言う　＆　と言う</h2><p>ように言う表示间接性引用（非直接对话内容），直接对话内容使用と言う，例如</p><blockquote><p>私は子供に宿題をするように言う         （间接转述）<br>私は子供にしゅくだいをしなさいと言う   （直接）</p></blockquote><h2 id="てはいけない・ならない・だめだ">てはいけない・ならない・だめだ</h2><p>いけない・ならない意思相近，均为禁止/不可以这么做，其中后者的约束力更强<br>ては和では常略读为ちゃ・じゃ</p><h2 id="それで-＆-そこで">それで　＆　そこで</h2><p>それで指前项<strong>造成</strong>的结果（客观性），译为“因此”，与そのために・それだから意思相近，前后因果关系强</p><blockquote><p>私は最近タバコを止めました。それで健康になりました<br>それで还可以表示“所以呢”，类似于“so”，可简化为で</p></blockquote><p>そこで指针对前项内容<strong>做出</strong>的结果（主观性），译为“为此，于是”，相当于そういうわけで</p><blockquote><p>足を怪我した、そこで病院へ行くことにした<br>そこで还可以表示“接下来/next”，相当于さて<br>そこで还可以表示“当下时刻”，相当于この時に</p></blockquote><h1>第七天</h1><p>##　まで表“甚至”</p><blockquote><p>あなたまでそう思うの？    （连你也那样想吗）</p></blockquote><h2 id="でも">でも</h2><h3 id="名词-でも">名词 + でも</h3><p>中文释义：连···都···</p><blockquote><p>そんなことは子供でもできます</p></blockquote><h3 id="名词-でも-2">名词 + でも</h3><p>中文释义：邀请性质的举例</p><blockquote><p>お茶でもを飲みますか</p></blockquote><p>###　疑问词 + でも</p><p>中文释义：无论···都···（与も相同）</p><blockquote><p>わからないことがあったらいつでも聞いてください</p></blockquote><h2 id="も">も</h2><h3 id="疑问词-も">疑问词 + も</h3><p>中文释义：无论···都···（与でも相同）</p><blockquote><p>どちらも正しいです</p></blockquote><p>###　数量词 + も（经历）</p><blockquote><p>わたしは一度も中国に行ったことがありません      我一次中国也没去过<br>わたしは何度も中国に行ったことがありません      我没去过中国几次<br>わたしは何度も中国に行ったことがあります        我去过中国很多次</p></blockquote><h3 id="数量词-も（惊讶）">数量词 + も（惊讶）</h3><blockquote><p>彼は百曲も作ったことができます     他创作的歌曲甚至超过100首<br>　財布の中には百円も残っていません   钱包里只剩下不到一百元</p></blockquote><h3 id="名詞-も">名詞 + も</h3><p>中文释义：连···都···</p><h3 id="形容詞く-も">形容詞く + も</h3><p>中文释义：最···</p><blockquote><p>遅くも夕方には帰ります    最晚傍晚就会回来</p></blockquote><h2 id="も与でも的混用">も与でも的混用</h2><h3 id="誰でも-＆-誰もが">誰でも　＆　誰もが</h3><p>一般用于肯定句，が代表的是疑问词的主语</p><blockquote><p>ここは誰でも・誰もが食事できる場所だ</p></blockquote><h3 id="誰も">誰も</h3><p>一般用于否定句，中文表示都没有···或都无法···</p><blockquote><p>誰もそんなことを言っていない<br>誰もできない</p></blockquote><h3 id="誰にも">誰にも</h3><p>一般用于否定句，中文表示（以其他所有人为对象）没有···</p><blockquote><p>誰にも言っていない<br>誰にも負けない</p></blockquote><h2 id="终助词">终助词</h2><h3 id="かい-＆-だい">かい　＆　だい</h3><p>男性用法，跟在普通形（词干·词干）或普通形（なの·なの），其中かい多用于没有疑问词的句子，だい一般与疑问词连用</p><blockquote><p>学校の成績は良かったかい？<br>　全部言ったらどうだい？</p></blockquote><h3 id="の">の</h3><p>女性用法，用法为普通形（な·な）以及疑问词+な</p><blockquote><p>会議はいつなの？</p></blockquote><p>の可以表示三种含义</p><ul><li>疑问词（同かい·だい）</li><li>强调</li><li>女性的命令形（对应的是男性用法な）</li></ul><h3 id="のだ・んだ">のだ・んだ</h3><p>のだ口语化为んだ，为男性的强调用法，与女性的の相对</p>]]></content>
      
      
      <categories>
          
          <category> 日语 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 日语文法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>B-V方程</title>
      <link href="/posts/61481/"/>
      <url>/posts/61481/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
        <tags>
            
            <tag> 电化学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>电化学基础</title>
      <link href="/posts/25066/"/>
      <url>/posts/25066/</url>
      
        <content type="html"><![CDATA[<h1>关于</h1><p>天坑专业大四就读，未来还不知道往哪个方向发展…不过现阶段对电化学还算感兴趣，所以从2022年底开始学习Bard的经典著作《Electrochemical methods Fundamentals and applications》。整个电化学专题就是基于这本书展开的。此外，<a href="https://www.koushare.com/video/videodetail/33204">中科大的电化学课程</a>也非常值得一看，算是对理论和应用方面的补充。</p><blockquote><p>因水平有限，以下内容仅作为笔记使用</p></blockquote><h1>电化学热力学</h1><p>本章内容主要基于Bard书的第1章、第2章、第4章和第13章，主要内容有电极过程、电势、传质原理、双电层模型。</p><h2 id="电极过程">电极过程</h2><p>在热力学中，反应发生的趋势是用吉布斯自由能 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi></mrow><annotation encoding="application/x-tex">G</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">G</span></span></span></span> 或化学势 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>μ</mi></mrow><annotation encoding="application/x-tex">\mu</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">μ</span></span></span></span> 来衡量的。在物质的浓度/压力不变的前提下，反应的趋势只与温度相关，因此有些反应（例如 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">C</mi><msub><mi mathvariant="normal">O</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">\rm CO_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathrm">C</span><span class="mord"><span class="mord mathrm">O</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span> 的热转化）在高温下才能进行。而在体系中加入电势这一变量后，电子的能量将发生变化，引起平衡的变化。如当电极电势更负时，电子能量升高，因此电子更容易从电极转移到反应介质中，发生还原反应。因此电化学的微观简单来说就是电子的能量的变化引起反应平衡的改变。</p><blockquote><p>2022年7月初参加FDU化学系面试的时候，有一个问题就是如何从微观角度理解电化学反应。因为我当时对电化学的了解不超过本科的物理化学课程，所以只能简单的用热力学的知识应付过去。</p></blockquote><p><img src="https://picgo-liubaichen.oss-cn-beijing.aliyuncs.com/20230315192938.png" alt=""></p><h2 id="电势">电势</h2><p>本节主要介绍电化学中的各种势能，参考资料包括ACS energy letters的一篇科普性文献。</p><h3 id="电化学势">电化学势</h3><p>在上一节中已经知道了，电极电势的变化引起反应平衡的变化。为了将这种影响引入到 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>μ</mi></mrow><annotation encoding="application/x-tex">\mu</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">μ</span></span></span></span> ，提出了新的物理量<strong>电化学势(electrochemical potential)</strong>，其定义式为：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msubsup><mover accent="true"><mi>μ</mi><mo>ˉ</mo></mover><mi>i</mi><mi>α</mi></msubsup><mo>=</mo><msubsup><mi>μ</mi><mi>i</mi><mi>α</mi></msubsup><mo>+</mo><msub><mi>z</mi><mi>i</mi></msub><mi>F</mi><msup><mi>ϕ</mi><mi>α</mi></msup></mrow><annotation encoding="application/x-tex">\bar{\mu}_i^\alpha =\mu_i^\alpha + z_iF\phi^{\alpha} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9614em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">μ</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7144em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.0037em;">α</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9614em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7144em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.0037em;">α</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.9088em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord"><span class="mord mathnormal">ϕ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7144em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.0037em;">α</span></span></span></span></span></span></span></span></span></span></span></span></span></p><p>其中 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mover accent="true"><mi>μ</mi><mo>ˉ</mo></mover><mi>i</mi><mi>α</mi></msubsup></mrow><annotation encoding="application/x-tex">\bar{\mu}_i^\alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9231em;vertical-align:-0.2587em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">μ</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-2.4413em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.0037em;">α</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2587em;"><span></span></span></span></span></span></span></span></span></span> 为电化学势，z为粒子所带电荷数，F为faraday constant，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϕ</mi></mrow><annotation encoding="application/x-tex">\phi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">ϕ</span></span></span></span> 为粒子所在位置的电势，上标 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi></mrow><annotation encoding="application/x-tex">\alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span></span></span></span> 表示粒子所处的相。</p><p>关于电化学势，该文献举的一个例子非常有意思：用一个电压表测量两种相连的金属丝，其结果是0。我们可能会想当然地认为，体系的电势差为0。实际上这是错误的，因为两种金属之间必然会有接触电势！那么问题出在哪呢？</p><p>在有电势存在的体系中，必须要考虑电势的影响，因此电化学势之差才是传输和反应的根本驱动力。电压表测量的是电化学势的差值，并不是两点的电势之差。只有在化学势相同的前提下（如同一种金属线），电压表测量的数值才能被视为电势差。而对于电极-电解液体系，电平衡条件为两相的电化学势相同。</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>J</mi><mi>i</mi></msub><mo>=</mo><mo>−</mo><mrow><mo fence="true">(</mo><mfrac><mrow><msub><mi>C</mi><mi>i</mi></msub><mo>×</mo><msub><mi>D</mi><mi>i</mi></msub></mrow><mrow><mi>R</mi><mi>T</mi></mrow></mfrac><mo fence="true">)</mo></mrow><mi mathvariant="normal">∇</mi><msub><mover accent="true"><mi>μ</mi><mo>ˉ</mo></mover><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">J_i=-\left(\frac{C_i\times D_i}{RT}\right)\nabla{\bar{\mu}}_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0962em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"></span><span class="mord">−</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">RT</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">∇</span><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">μ</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2175em;"><span style="top:-2.4559em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2441em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>其中C和D分别为浓度和扩散系数。</p><blockquote><p>电化学中，电化学势与Fermi能级为等价概念</p></blockquote><h3 id="外电势、内电势、表面电势和功函">外电势、内电势、表面电势和功函</h3><p>内电势 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϕ</mi><mo stretchy="false">(</mo><mi>i</mi><mi>n</mi><mi>n</mi><mi>e</mi><mi>r</mi><mi>p</mi><mi>o</mi><mi>t</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>i</mi><mi>a</mi><mi>l</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\phi (inner potential)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">ϕ</span><span class="mopen">(</span><span class="mord mathnormal">inn</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mord mathnormal">p</span><span class="mord mathnormal">o</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ia</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mclose">)</span></span></span></span> ：单位正电荷从无穷远移动到某相内部克服电场力所做的功（体相电势与无穷远处的电势差，也称为Galvani potential）。</p><p>外电势 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ψ</mi></mrow><annotation encoding="application/x-tex">\psi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">ψ</span></span></span></span> (outer potential)：单位正电荷从无穷远移动到带电体外表面（表面之外，不包括表面附近的表面电势χ）克服电场力所做的功（两个带电物体间的外电势差，又称为Volta电势差）。</p><blockquote><p>外电势选取的参考点与双电层理论有关</p></blockquote><p>表面电势χ：由于金属表面电子受力不平衡，倾向于脱出而减小动能；这部分Fermi能级附近的电子与正离子核之间距离增加势能增大，形成电势差。</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>ϕ</mi><mo>=</mo><mi>ψ</mi><mo>+</mo><mi>χ</mi></mrow><annotation encoding="application/x-tex">\phi = ψ + χ</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">ϕ</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">ψ</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">χ</span></span></span></span></span></p><p>功函 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϕ</mi></mrow><annotation encoding="application/x-tex">\phi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">ϕ</span></span></span></span>（work function）：将一个电子从体相内部移到外部/外电势参考点所做的最小功（Fermi能级到金属表面），包括克服化学势和表面电势（但不包括外电势）</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi mathvariant="normal">Φ</mi><mo>=</mo><mo>−</mo><mfrac><msub><mi>μ</mi><mi>e</mi></msub><msub><mi>N</mi><mi>A</mi></msub></mfrac><mo>+</mo><mi>e</mi><mi>χ</mi></mrow><annotation encoding="application/x-tex">\Phi=-\frac{\mu_e}{N_A}+e\chi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">Φ</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.9436em;vertical-align:-0.836em;"></span><span class="mord">−</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1076em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.836em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">eχ</span></span></span></span></span></p><p>通过图例可能更有助于理解：</p><p><img src="https://picgo-liubaichen.oss-cn-beijing.aliyuncs.com/20230315210908.png" alt="" title="各种势能的关系"><br><img src="https://picgo-liubaichen.oss-cn-beijing.aliyuncs.com/20230315212050.png" alt="" title="表面电势"></p><h3 id="开路电势">开路电势</h3><p>开路电势（open-circuit potential）:无电流情况下电化学工作站直接读出的数值，其与反应的平衡电势有一定的关系。在存在平衡条件的前提下，理论上开路电势可以由体系中所有电对的平衡电势得到。</p><h3 id=""></h3><blockquote><p>Boettcher, Shannon W., et al. “Potentially confusing: potentials in electrochemistry.” ACS Energy Letters 6.1 (2020): 261-266.</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 化学 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 电化学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>katex在hexo中的使用</title>
      <link href="/posts/48857/"/>
      <url>/posts/48857/</url>
      
        <content type="html"><![CDATA[<h1>安装</h1><p>网页基于butterfly主题，安装方法参考<a href="https://butterfly.js.org/posts/ceeb73f/#Math-%E6%95%B8%E5%AD%B8">官方文档</a>。</p><p>以下使用方法基于renderer-markdown-it插件<br>最重要的一点：别忘了在文章开头声明<strong>katex: true</strong></p><h1>使用</h1><h2 id="行内公式">行内公式</h2><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>t</mi></msub><mo>=</mo><msub><mi>b</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">a_t = b_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$a_t = b_t$</span><br></pre></td></tr></table></figure><h2 id="行间公式">行间公式</h2><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi mathvariant="normal">C</mi><msub><mi mathvariant="normal">O</mi><mn>2</mn></msub><mrow><mo fence="true">(</mo><mi mathvariant="normal">g</mi><mo fence="true">)</mo></mrow><mo>+</mo><mo>∗</mo><mo>+</mo><msup><mi mathvariant="normal">e</mi><mo>−</mo></msup><mo>→</mo><mtext> </mtext><mo>∗</mo><msubsup><mrow><mi mathvariant="normal">C</mi><mi mathvariant="normal">O</mi></mrow><mn>2</mn><mo>−</mo></msubsup></mrow><annotation encoding="application/x-tex">\rm CO_2\left(g\right)+\ast+e^-\rightarrow\ \ast{\rm CO}_2^- </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0946em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathrm">C</span><span class="mord"><span class="mord mathrm">O</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord mathrm" style="margin-right:0.01389em;">g</span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">∗</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathrm">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8213em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">−</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace"> </span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">∗</span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathrm">CO</span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8446em;"><span style="top:-2.453em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">2</span></span></span><span style="top:-3.1362em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">−</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$$ \rm CO_2\left(g\right)+\ast+e^-\rightarrow\ \ast&#123;\rm CO&#125;_2^- $$</span><br></pre></td></tr></table></figure><h2 id="多行公式">多行公式</h2><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd class ="mtr-glue"></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mi>a</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>b</mi><mo>+</mo><mi>c</mi></mrow></mstyle></mtd><mtd class ="mtr-glue"></mtd><mtd class ="mml-eqn-num"></mtd></mtr><mtr><mtd class ="mtr-glue"></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>d</mi><mo>+</mo><mi>e</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>f</mi></mrow></mstyle></mtd><mtd class ="mtr-glue"></mtd><mtd class ="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex"> \begin{align}   a&amp;=b+c \\   d+e&amp;=f\end{align} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3em;vertical-align:-1.25em;"></span><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.75em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">a</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.25em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.75em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">c</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.25em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.75em;"><span style="top:-3.75em;"><span class="pstrut" style="height:2.84em;"></span><span class="eqn-num"></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:2.84em;"></span><span class="eqn-num"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.25em;"><span></span></span></span></span></span></span></span></span></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$$ \begin&#123;align&#125;</span><br><span class="line">   a&amp;=b+c \\</span><br><span class="line">   d+e&amp;=f</span><br><span class="line"> \end&#123;align&#125; $$</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> diary </category>
          
      </categories>
      
      
        <tags>
            
            <tag> latex </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用selenium自动登录163邮箱和爬取淘宝</title>
      <link href="/posts/64056/"/>
      <url>/posts/64056/</url>
      
        <content type="html"><![CDATA[<h1>Ajax</h1><p>Ajax数据指网页浏览过程中逐步加载的数据，这些数据使用requests是无法获取的，但可以借助selenium获得。</p><p>在inspect的network界面中，以getindex开头、type为xhr的数据请求即为ajax。</p><h1>163自动登录</h1><blockquote><p>2023.3.16</p></blockquote><p>花了大概两个小时，终于搞定了163邮箱自动登录！</p><p><img src="https://picgo-liubaichen.oss-cn-beijing.aliyuncs.com/20230315100737.png" alt="" title="a great success!"></p><p>真的不能太依赖edge元素审查中的css和xpath！能自己写的尽量自己写（特别是iframe的路径）！<br>新打开的页面上一定要用sleep或webdriverwait，implicitly_wait有的地方就是不行（没有理解隐式和显式的区别）</p><p>还有就是要吐槽一下，163在登陆几次后好像就会有验证码审查…</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support.wait <span class="keyword">import</span> WebDriverWait</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support <span class="keyword">import</span> expected_conditions <span class="keyword">as</span> EC</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果要用的话，直接修改最后的account、password和tos（收件人，仅限一个，多个也可以，懒得写了）就行</span></span><br><span class="line"><span class="comment"># 依赖库：selenium</span></span><br><span class="line"><span class="comment"># 如果之前没用过selenium还需要安装浏览器对应的webdriver（这里是edge），需要自行查阅相关资料</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    options = webdriver.EdgeOptions()</span><br><span class="line">    options.add_experimental_option(<span class="string">&#x27;excludeSwitches&#x27;</span>, [<span class="string">&#x27;enable-logging&#x27;</span>])</span><br><span class="line">    os.system(<span class="string">&#x27;cls&#x27;</span>)    <span class="comment"># clear terminal</span></span><br><span class="line">    driver = webdriver.Edge(options=options)        <span class="comment"># edge可能会出现奇怪的警告（原因不明），options可以消除这些警告</span></span><br><span class="line">    driver.get(<span class="string">&#x27;https://mail.163.com/&#x27;</span>)</span><br><span class="line">    driver.maximize_window()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sign_in</span>():</span><br><span class="line">        <span class="comment"># 这里不用wait可能也可以？不过由于163邮箱网页加载慢，不wait可能出现找不到attribute的情况</span></span><br><span class="line">        driver.implicitly_wait(<span class="number">10</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            label = driver.find_elements(By.TAG_NAME,<span class="string">&#x27;iframe&#x27;</span>)</span><br><span class="line">            driver.switch_to.frame(label[<span class="number">0</span>])</span><br><span class="line">            driver.find_element(By.NAME,<span class="string">&#x27;email&#x27;</span>).send_keys(account)</span><br><span class="line">            driver.find_element(By.NAME,<span class="string">&#x27;password&#x27;</span>).send_keys(password)</span><br><span class="line">            <span class="comment">#driver.find_element(By.NAME,&#x27;un-login&#x27;).click()    # 30天免登录</span></span><br><span class="line">            driver.find_element(By.ID,<span class="string">&#x27;dologin&#x27;</span>).click()</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(e)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">write</span>():</span><br><span class="line">        <span class="comment"># 点击主界面的写信button，进入write界面</span></span><br><span class="line">        sleep(<span class="number">3</span>)</span><br><span class="line">       <span class="comment"># element = WebDriverWait(driver, 10, 0.4).until(</span></span><br><span class="line">                    <span class="comment">#EC.presence_of_element_located((By.ID, &#x27;_mail_component_74_74&#x27;)),</span></span><br><span class="line">                                              <span class="comment">#  message=&#x27;写信button已超时&#x27;)</span></span><br><span class="line">        driver.find_element(By.ID,<span class="string">&#x27;_mail_component_74_74&#x27;</span>).click()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 输入收信人</span></span><br><span class="line">        driver.find_element(By.CLASS_NAME,<span class="string">&#x27;nui-editableAddr-ipt&#x27;</span>).send_keys(tos)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">#输入主题</span></span><br><span class="line">        driver.find_element(By.XPATH,<span class="string">&quot;//div[@class = &#x27;bz0&#x27;]/div/input[@class = &#x27;nui-ipt-input&#x27;]&quot;</span>).send_keys(<span class="string">&#x27;test letter&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 进入body iframe，输入信的主体内容</span></span><br><span class="line">        driver.switch_to.frame(driver.find_element(By.XPATH,<span class="string">&quot;//iframe[contains(@class,&#x27;APP-editor-iframe&#x27;)]&quot;</span>))</span><br><span class="line">        driver.find_element(By.XPATH,<span class="string">&#x27;/html/body&#x27;</span>).send_keys(text)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 回到write界面，发送</span></span><br><span class="line">        sleep(<span class="number">2</span>)</span><br><span class="line">        driver.switch_to.default_content()</span><br><span class="line">        driver.find_element(By.XPATH,<span class="string">&#x27;//*[@class=&quot;jp0&quot;]/div[@role=&quot;button&quot;][1]&#x27;</span>).click() </span><br><span class="line">        sleep(<span class="number">3</span>)</span><br><span class="line">        driver.quit()</span><br><span class="line">          </span><br><span class="line">    sign_in()</span><br><span class="line">    write()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    account = <span class="string">&#x27;XXXXXXXXX&#x27;</span></span><br><span class="line">    password = <span class="string">&#x27;XXXXXXXXX&#x27;</span></span><br><span class="line">    tos = <span class="string">&#x27;XXXXXXXXX&#x27;</span></span><br><span class="line">    text = <span class="string">&#x27;this is a test letter from python_selenium&#x27;</span></span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h1>反检测手段</h1><p>主要手段是添加各种option，还需要读取stealth.min.js文件隐藏webdriver特征</p><h2 id="通用代码">通用代码</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建option项</span></span><br><span class="line">options = webdriver.EdgeOptions()</span><br><span class="line"><span class="comment"># 允许log，否则会连续警告</span></span><br><span class="line">options.add_experimental_option(<span class="string">&#x27;excludeSwitches&#x27;</span>, [<span class="string">&#x27;enable-logging&#x27;</span>])</span><br><span class="line"><span class="comment"># headless模式需要添加user认证</span></span><br><span class="line">options.add_argument(<span class="string">&#x27;--headless&#x27;</span>)</span><br><span class="line">options.add_argument(<span class="string">&#x27;user-agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.71 Safari/537.36&#x27;</span>)</span><br><span class="line"><span class="comment"># 导入edge的个人信息</span></span><br><span class="line">p=<span class="string">r&#x27;C:\Users\Hashimoto\AppData\Local\Microsoft\Edge\User&#x27;</span></span><br><span class="line">options.add_experimental_option(<span class="string">&#x27;excludeSwitches&#x27;</span>, [<span class="string">&#x27;enable-automation&#x27;</span>])  <span class="comment"># 以开发者模式</span></span><br><span class="line">options.add_argument(<span class="string">&#x27;--user-data-dir=&#x27;</span>+p)</span><br><span class="line"><span class="comment"># 创建webdriver</span></span><br><span class="line">driver = webdriver.Edge(options=options)</span><br><span class="line"><span class="comment"># 读取webdriver反检测文件</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;F:\\python\\stealth.min.js&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    js = f.read()</span><br><span class="line">driver.execute_cdp_cmd(<span class="string">&quot;Page.addScriptToEvaluateOnNewDocument&quot;</span>, &#123;</span><br><span class="line">  <span class="string">&quot;source&quot;</span>: js</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">os.system(<span class="string">&#x27;cls&#x27;</span>)</span><br><span class="line">driver.get(<span class="string">&#x27;https://s.taobao.com/search?q=iphone&#x27;</span>)</span><br><span class="line">driver.maximize_window()</span><br></pre></td></tr></table></figure><p>通过上述手段就可以顺利打开淘宝的详情页面，并且无需登录</p><h2 id="edge个人信息">edge个人信息</h2><p>在edge的地址搜索框中输入 <strong>edge://version/</strong> ，复制Profile path（个人资料路径）</p><h2 id="stealth-min-js文件">stealth.min.js文件</h2><p>在已安装node.js的前提下，在目标文件夹的cmd中输入：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx extract-stealth-evasions</span><br></pre></td></tr></table></figure><p>之后将上述路径替换即可</p><h1>爬取淘宝商品信息</h1><blockquote><p>2023.3.17</p></blockquote><p>淘宝的反爬虫手段比较强，必须借助上一节中的反反爬虫方法才有可能成功。即便如此，在爬取过多时，淘宝可能会要求滑动验证。</p><h2 id="依赖库">依赖库</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.common.exceptions <span class="keyword">import</span> TimeoutException</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support <span class="keyword">import</span> expected_conditions <span class="keyword">as</span> EC</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support.wait <span class="keyword">import</span> WebDriverWait</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="comment"># 使用beautifulsoup解析，json存储</span></span><br></pre></td></tr></table></figure><h2 id="webdriver创建">webdriver创建</h2><p>参考反检测手段一节中的代码</p><p>实测结果是，可以不用stealth.min.js，但是必须添加个人信息路径</p><h2 id="使用selenium获取html">使用selenium获取html</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">index_page</span>(<span class="params">page</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;正在爬取第&#x27;</span>,page,<span class="string">&#x27;页&#x27;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        url = <span class="string">&#x27;https://s.taobao.com/search?q=&#x27;</span> + KEYWORD</span><br><span class="line">        driver.get(url)</span><br><span class="line">        <span class="keyword">if</span> page&gt;<span class="number">1</span>:</span><br><span class="line">            <span class="comment"># 输入跳转页码</span></span><br><span class="line">            <span class="built_in">input</span> = wait.until(EC.presence_of_element_located((By.CSS_SELECTOR,<span class="string">&#x27;#mainsrp-pager div.form &gt; input&#x27;</span>)))</span><br><span class="line">            <span class="built_in">input</span>.clear() ; <span class="built_in">input</span>.send_keys(page)</span><br><span class="line">            <span class="comment"># 跳转页码</span></span><br><span class="line">            submit = wait.until(EC.element_to_be_clickable((By.CSS_SELECTOR,<span class="string">&#x27;#mainsrp-pager div.form &gt; span.btn.J_Submit&#x27;</span>)))</span><br><span class="line">            submit.click()</span><br><span class="line">        <span class="comment"># 确定目前所处页码</span></span><br><span class="line">        wait.until(EC.text_to_be_present_in_element((By.CSS_SELECTOR,<span class="string">&#x27;#mainsrp-pager li.item.active &gt; span&#x27;</span>),<span class="built_in">str</span>(page)))</span><br><span class="line">        <span class="comment"># 商品栏可定位</span></span><br><span class="line">        wait.until(EC.presence_of_element_located((By.CSS_SELECTOR,<span class="string">&#x27;.m-itemlist .items .item&#x27;</span>)))</span><br><span class="line">        parse_html()</span><br><span class="line">    <span class="comment"># 如果超时则重复这个过程</span></span><br><span class="line">    <span class="keyword">except</span> TimeoutException:</span><br><span class="line">        index_page(page)</span><br></pre></td></tr></table></figure><h2 id="使用beautifulsoup解析html">使用beautifulsoup解析html</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">parse_html</span>():</span><br><span class="line">    html = driver.page_source</span><br><span class="line">    soup = BeautifulSoup(html,<span class="string">&#x27;lxml&#x27;</span>)</span><br><span class="line">    <span class="comment"># 使用css选择器寻找每一个商品div</span></span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span>  soup.select(<span class="string">&#x27;#mainsrp-itemlist .items .item&#x27;</span>):</span><br><span class="line">        product = &#123;<span class="string">&#x27;image&#x27;</span>: item.select(<span class="string">&#x27;.pic .img&#x27;</span>)[<span class="number">0</span>].attrs[<span class="string">&#x27;data-src&#x27;</span>],</span><br><span class="line">                   <span class="string">&#x27;price&#x27;</span>: item.select(<span class="string">&#x27;.price&#x27;</span>)[<span class="number">0</span>].get_text().strip(<span class="string">&#x27; \n&#x27;</span>),</span><br><span class="line">                   <span class="string">&#x27;deal&#x27;</span>: item.select(<span class="string">&#x27;.deal-cnt&#x27;</span>)[<span class="number">0</span>].get_text(),</span><br><span class="line">                   <span class="string">&#x27;title&#x27;</span>: item.select(<span class="string">&#x27;.title&#x27;</span>)[<span class="number">0</span>].get_text().strip(<span class="string">&#x27; \n&#x27;</span>),</span><br><span class="line">                   <span class="string">&#x27;shop&#x27;</span>: item.select(<span class="string">&#x27;.shop&#x27;</span>)[<span class="number">0</span>].get_text().strip(<span class="string">&#x27; \n&#x27;</span>),</span><br><span class="line">                   <span class="string">&#x27;location&#x27;</span>: item.select(<span class="string">&#x27;.location&#x27;</span>)[<span class="number">0</span>].get_text()&#125;</span><br><span class="line">        save(product)</span><br></pre></td></tr></table></figure><p>注意css选择器的写法：<strong>.item</strong>匹配全部包含item的class，而 <strong>#id</strong> 为精准匹配<br>css选择器简介教程参考：</p><ol><li>简洁版：<a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/CSS_Selectors">火狐官方</a></li><li>完整版：<a href="https://www.w3cschool.cn/css/css-selector.html">中文</a>; <a href="https://www.w3schools.com/cssref/css_selectors.php">英文</a></li></ol><h2 id="保存与主函数">保存与主函数</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">save</span>(<span class="params">data</span>):</span><br><span class="line">    name = data[<span class="string">&#x27;shop&#x27;</span>]</span><br><span class="line">    price = data.get(<span class="string">&#x27;price&#x27;</span>)</span><br><span class="line">    deal = data.get(<span class="string">&#x27;deal&#x27;</span>)</span><br><span class="line">    data_path = <span class="string">f&#x27;<span class="subst">&#123;result_doc&#125;</span>/<span class="subst">&#123;name&#125;</span>-<span class="subst">&#123;price&#125;</span>-<span class="subst">&#123;deal&#125;</span>.json&#x27;</span></span><br><span class="line">    json.dump(data,<span class="built_in">open</span>(data_path,<span class="string">&#x27;w&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>),ensure_ascii=<span class="literal">False</span>,indent = <span class="number">2</span>)     </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">MAX_PAGE = <span class="number">1</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, MAX_PAGE + <span class="number">1</span>):</span><br><span class="line">        index_page(i)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h1>问题总结</h1><p><em>DevTools listening on ws://······</em></p><blockquote><p>edge又自动更新了！！！去更新你的edgedriver吧</p></blockquote><p><em>到系统上的设备 没有发挥作用</em></p><blockquote><p>无意义报错，不影响使用</p></blockquote><h1>参考资料</h1><ol><li><a href="https://python3webspider.cuiqingcai.com/7.4-shi-yong-selenium-pa-qu-tao-bao-shang-pin">崔庆才博客</a></li><li><a href="https://blog.csdn.net/m0_49449205/article/details/124041314">绕过反爬机制</a></li><li><a href="https://bbs.huaweicloud.com/blogs/350270">selenium入门教程，值得一看</a></li><li><a href="https://blog.csdn.net/weixin_45230019/article/details/115282460">selenium自动化入门之实现163邮箱发送邮件</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> scraping </tag>
            
            <tag> selenium </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>requests</title>
      <link href="/posts/9149/"/>
      <url>/posts/9149/</url>
      
        <content type="html"><![CDATA[<ul><li>about requests</li></ul><p>today’s work</p><ol><li>python basic knowledge: class and instance</li><li>scrape douban by requests</li><li>about html: div and li</li></ol><p><img src="https://picgo-liubaichen.oss-cn-beijing.aliyuncs.com/%E6%9C%AA%E5%91%BD%E5%90%8D%E5%9B%BE%E7%89%87.png" alt="我爱mami" title="疯狂迫害"></p>]]></content>
      
      
      <categories>
          
          <category> diary </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 杂谈 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>regular expression</title>
      <link href="/posts/4493/"/>
      <url>/posts/4493/</url>
      
        <content type="html"><![CDATA[<ul><li>about regex</li></ul><p>main point</p><ol><li>if <em>(.*?)</em> lies in the last of regex, you will get nothing!!!</li><li>remember compile regex with optional modifiers such as <em>re.M</em> firstly or directly write regex when you use it just like</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    regex = re.<span class="built_in">compile</span>(regex,optional modifier)</span><br><span class="line">    content_1 = regex.findall(<span class="built_in">str</span>)</span><br><span class="line">    --------------------------------------------------- </span><br><span class="line">    content_2 = re.findall(regex,<span class="built_in">str</span>,optional modifier)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> diary </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 杂谈 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>《一个大国的崛起与崩溃》读书笔记-1</title>
      <link href="/posts/12329/"/>
      <url>/posts/12329/</url>
      
        <content type="html"><![CDATA[<h1>about</h1><p>《一个大国的崛起与崩溃————苏联历史专题研究（1917-1991）》的主编沈志华先生是我非常喜欢的一位苏联史学家，在看本书之前就已经在YouTube上聆听了先生的多场讲座，拜读了先生所著的中苏关系史（关于本书的笔记可能还要再过一段时间）。沈先生非常重视史料研究，他认为，历史学家的本职工作就是尽可能真实客观地还原历史，如何评价历史是政治家的责任。这与复旦大学历史学家葛剑雄“历史为政治服务”的观点刚好相反。我认为首先给出我的观点是有必要的：我始终坚定地认为历史就是事实，就是关于每一个人的所作所为以及他们对人类社会产生的影响（当然我们更关注一小部分关键人物的行为）。当然不得不承认的是，无论是中国的过去还是现在，历史都被政治所控制，大多数历史学家难以触碰到最珍贵的历史资料，还原事实也就成为了一件不可能的事。但无法实现绝对公平不代表追求公平没有意义，正是因为有无数的人为了保存史料而不惜牺牲生命，我们才得以突破官方的封锁，不断接近事实。</p><h1>历史性的转折：1917年俄国革命</h1><h2 id="俄国革命的根源">俄国革命的根源</h2><p>革命的根源：历史长期因素（结构）、中期因素（形势）、短期因素（事件）</p><h3 id="长期因素：俄国现代化的结构性矛盾">长期因素：俄国现代化的结构性矛盾</h3><p>18世纪初期的彼得一世改革奠定俄罗斯成为现代国家的基础，但也导致政治生活领域的停滞和巨大的社会牺牲，并暗藏着尖锐的矛盾——东西方之间在政治制度、文化、阶级的矛盾；1861年亚历山大二世废除农奴制等一系列举措，在很大程度上缓解了上述矛盾。然而思想解放同时导致民粹派迅速发展，以至于亚历山大二世被刺杀，和平过渡的想法落空了。<br>直到1917年，土地仍然是俄国最棘手的问题。一是地主土地所有制，二是村社将农民束缚于土地之上，抑制农民的分化。农村之外，城市的新兴资产阶级也团结起来，并在1899年成立了俄国自由主义第一个政治组织“聚谈”。以上便是俄国现代化的两大障碍：土地问题和政治制度问题。</p><h3 id="中期因素：第一次革命后的形势变化">中期因素：第一次革命后的形势变化</h3><p>1905年革命后的斯托雷平改革彻底摧毁了帝俄的旧村社和旧土地制度，使俄国农业和经济迅速发展，但是也导致俄国农民的价值观念发生显著变化，逐渐形成了公民意识和民主精神，使得最容易被控制的农民走上了反对沙皇的斗争道路。斯托雷平体系的失败以及新形势的出现，加剧了系统性危机。</p><h3 id="短期因素：战争影响下的事态发展">短期因素：战争影响下的事态发展</h3><p>一次大战爆发后，短时间内高涨的爱国主义热情延缓了政治危机的发展。但是战争所导致的物质危机又进一步激化了现有矛盾，推动事态向革命方向发展。借由战争，自由主义者在各地建立起合法的社会组织，它们一方面为战争提供后勤保障，一方面又被视为促进政治改革的工具。这些组织成为二月革命中的核心力量。</p><h2 id="自发的二月革命">自发的二月革命</h2>]]></content>
      
      
      <categories>
          
          <category> 历史 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 苏联史 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>beautifulsoup use</title>
      <link href="/posts/39160/"/>
      <url>/posts/39160/</url>
      
        <content type="html"><![CDATA[<p>今日工作：</p><ol><li>beautifulsoup学习，成功爬取了博客主页的文章title、abstract和对应文章的主体内容（终于有了一点小小的成就感）</li><li>开始把以前写的draft发到网站上</li></ol><hr><p>今天晚上开始学习requests的时候发生了一个重大错误：我把py文件命名成了requests！！！<br>然后就开始疯狂报错…<br>最开始我认为是刚刚pip install，所以重启了vscode。然后又尝试了换一个文件等等，最后突然意识到好像命名有问题…</p>]]></content>
      
      
      <categories>
          
          <category> diary </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 杂谈 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>picture test</title>
      <link href="/posts/34566/"/>
      <url>/posts/34566/</url>
      
        <content type="html"><![CDATA[<h1>图片与图床使用</h1><p>今日工作：</p><ol><li>python面向对象学习和爬虫</li><li>课设计算推进一点（大概吧）</li><li>学习图床使用<br><img src="https://picgo-liubaichen.oss-cn-beijing.aliyuncs.com/528354450.jpg" alt="" title="圆神！"></li></ol><p>遇到的问题：</p><ol><li>本来想用github当服务器，结果就是生成不了token</li><li>math插件安装失败（应该是npm的原因），暂时无法解决</li><li>学习python写作中遇到txt文件open后的read操作：因为某个窒息的理解错误白白浪费半小时！</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    file1 = <span class="built_in">open</span>(<span class="string">&#x27;F:\\python\\python_code\\test.txt&#x27;</span>,<span class="string">&#x27;r&#x27;</span>,encoding=<span class="string">&quot;utf8&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(file1.read())            </span><br><span class="line">    <span class="comment">#all text</span></span><br><span class="line">    file1.readlines()    </span><br><span class="line">    file1.close()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>读完第一次后指针都到末尾了，还怎么readlines啊！！！</strong></p>]]></content>
      
      
      <categories>
          
          <category> diary </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 杂谈 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>First scraping</title>
      <link href="/posts/38424/"/>
      <url>/posts/38424/</url>
      
        <content type="html"><![CDATA[<h1>我的第一个爬虫</h1><p>今日工作：浅尝辄止地学习了html、css和javascript，可以读懂基本语句；回顾了布朗运动、fick第一定律；开始学习python爬虫。</p><h2 id="scraping">scraping</h2><p>重现<em>书</em>中的代码，根据元素的属性爬取《战争与和平》节选部分中的全部人名。</p><blockquote><p>Python网络数据采集</p></blockquote><h2 id="网页三件套">网页三件套</h2><p>为了能大概看懂网站的配置文件，html、css和javascript还是有必要了解的。</p><blockquote><p><a href="https://www.w3schools.com/html/default.asp">https://www.w3schools.com/html/default.asp</a></p></blockquote><blockquote><p>本来是想放些代码上去的，但不知道怎样避免冲突，那就先这样吧…</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> diary </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 杂谈 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>First article</title>
      <link href="/posts/undefined/"/>
      <url>/posts/undefined/</url>
      
        <content type="html"><![CDATA[<h1>我的第一个网站</h1><p>经过近两天的折磨，终于用hexo搭建好了网站。虽然过程真的辛苦，甚至有好多次想放弃了（怒砸键盘），但还是坚持了下来。</p><p>这两天的工程主要包括：hexo创建、github部署和添加域名。</p><blockquote><p>域名（kotobanoniwa.xyz）是《<em><strong>言葉の庭</strong></em>》的罗马音，源自电影《言の葉の庭》，但是对我来说可能　<strong>言葉</strong>　可能更准确一些</p></blockquote><h2 id="Why">Why</h2><p>正值大四下半年，没有什么课，天天都是泡图书馆，所以就想做点什么。除了一些软件的学习和网站之外，日语和英语也在同步进行着（真的有在做吗?）。</p><h2 id="下一步的打算">下一步的打算</h2><p>文章的话，如果只是文字还好，不过图片之类的可能还要一段时间，毕竟还有其他工作要做。</p><p>感觉在这上面写点东西还挺好的，<strong>千万不要半途而废啊！</strong></p>]]></content>
      
      
      <categories>
          
          <category> diary </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 杂谈 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
    
    
    <entry>
      <title>about</title>
      <link href="/about/index.html"/>
      <url>/about/index.html</url>
      
        <content type="html"><![CDATA[<h1>about me</h1><ul><li>海河中下游某大学天坑专业就读</li><li>兴趣丰富，但一事无成</li><li>二次元爱好者，魔圆忠实粉丝（看配图就知道了嘛）</li><li>原三次元爱好者，主推乃木坂46的日奈子ちゃん</li><li>喜欢苏联史和中华人民共和国国史</li><li>python ing</li></ul><h1>配图说明</h1><ul><li>网页图标（favicon）：<a href="https://zh.moegirl.org.cn/%E9%B9%BF%E7%9B%AE%E5%9C%86">鹿目まどか</a>，来自<a href="https://zh.moegirl.org.cn/%E9%AD%94%E6%B3%95%E5%B0%91%E5%A5%B3%E5%B0%8F%E5%9C%86">魔法少女まどか☆マギア</a></li><li>网站logo（主页面左上角）：<a href="https://zh.moegirl.org.cn/%E5%A4%A9%E7%8E%8B%E5%AF%BA%E7%92%83%E5%A5%88">天王寺璃奈</a>，来自<a href="https://nijigaku.club/">虹ヶ咲スクールアイドル同好会</a></li><li>个人头像（avatar）：<a href="https://zh.moegirl.org.cn/%E5%87%A4%E6%BB%A1">鳳ミチル</a>，来自<a href="https://zh.moegirl.org.cn/%E5%B0%91%E5%A5%B3%E6%AD%8C%E5%89%A7_Revue_Starlight_-Re_LIVE-">少女☆歌剧 Revue Starlight</a></li></ul><blockquote><p>新歌 <strong>命尽きても尽き果てず</strong> 吹爆！</p></blockquote><ul><li>archives页首：クラリス(ClariS)</li><li>文章封面：<a href="https://zh.moegirl.org.cn/%E9%AD%94%E6%B3%95%E5%B0%91%E5%A5%B3%E5%B0%8F%E5%9C%86">魔法少女まどか☆マギア</a>的剧照、同人图等</li></ul><h1>网站概览</h1><ul><li>框架：hexo</li><li>服务器：github | gitee</li><li>域名：dynadot</li><li>主题：butterfly</li></ul><h1>域名说明</h1><p>kotobanoniwa，是日语<strong>言葉の庭</strong>的罗马音，译为 <strong>语言的庭院</strong>。</p>]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/categories/index.html"/>
      <url>/categories/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/tags/index.html"/>
      <url>/tags/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
  
</search>
